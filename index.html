<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinanceFlow - Organize suas Finan√ßas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged, updateProfile } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, query, where, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyBhRH760_hAthw737CrzmioyZrzCeK5H8s",
            authDomain: "calendario-53e49.firebaseapp.com",
            projectId: "calendario-53e49",
            storageBucket: "calendario-53e49.firebasestorage.app",
            messagingSenderId: "352958232134",
            appId: "1:352958232134:web:0775e16be712522b59bc47",
            measurementId: "G-8FYM5H6LCT"
        };
        
        const app = initializeApp(firebaseConfig);
        window.auth = getAuth(app);
        window.db = getFirestore(app);
        window.GoogleAuthProvider = GoogleAuthProvider;
        window.signInWithEmailAndPassword = signInWithEmailAndPassword;
        window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
        window.signInWithPopup = signInWithPopup;
        window.signOut = signOut;
        window.onAuthStateChanged = onAuthStateChanged;
        window.updateProfile = updateProfile;
        window.collection = collection;
        window.addDoc = addDoc;
        window.getDocs = getDocs;
        window.doc = doc;
        window.updateDoc = updateDoc;
        window.deleteDoc = deleteDoc;
        window.query = query;
        window.where = where;
        window.orderBy = orderBy;
        window.onSnapshot = onSnapshot;
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .pulse-success {
            animation: pulseSuccess 0.6s ease-in-out;
        }
        
        @keyframes pulseSuccess {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .expense-item {
            transition: all 0.3s ease;
        }
        
        .expense-item.paid {
            opacity: 0.7;
            transform: scale(0.98);
        }
        
        .expense-item.paid .expense-text {
            text-decoration: line-through;
            color: #9ca3af;
        }
        
        .floating-add {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        
        .floating-add:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }
        
        .modal-backdrop {
            backdrop-filter: blur(5px);
        }
        
        .progress-bar {
            transition: width 0.5s ease;
        }
        
        .nav-tab {
            transition: all 0.3s ease;
        }
        
        .nav-tab.active {
            background: white;
            color: #667eea;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .calendar-day {
            transition: all 0.2s ease;
            position: relative;
        }
        
        .calendar-day:hover {
            background-color: #f3f4f6;
        }
        
        .calendar-day.selected {
            background-color: #667eea;
            color: white;
        }
        
        .calendar-day.has-transactions {
            font-weight: 600;
        }
        
        .transaction-dot {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            top: 2px;
        }
        
        .dot-expense {
            background-color: #ef4444;
            right: 2px;
        }
        
        .dot-income {
            background-color: #10b981;
            right: 10px;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
        }
        
        .login-container {
            backdrop-filter: blur(10px);
            background: rgba(0, 0, 0, 0.5);
        }
        
        .login-modal {
            animation: slideInUp 0.4s ease-out;
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .btn-loading {
            position: relative;
            color: transparent !important;
        }
        
        .btn-loading::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            top: 50%;
            left: 50%;
            margin-left: -8px;
            margin-top: -8px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        
        .google-btn {
            transition: all 0.3s ease;
            background: white;
            border: 1px solid #dadce0;
        }
        
        .google-btn:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transform: translateY(-1px);
        }
        
        .password-toggle {
            transition: all 0.2s ease;
        }
        
        .password-toggle:hover {
            color: #3b82f6;
        }
        
        .form-transition {
            transition: all 0.3s ease;
        }
        
        .app-container {
            transition: all 0.5s ease;
        }
        
        .app-container.hidden {
            opacity: 0;
            transform: scale(0.95);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container fixed inset-0 flex items-center justify-center z-50">
        <div class="login-modal bg-white rounded-2xl shadow-2xl w-full max-w-md mx-4 p-8">
            <!-- Login Form -->
            <div id="loginForm" class="form-transition">
                <div class="text-center mb-8">
                    <div class="w-16 h-16 bg-gradient-to-r from-blue-600 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-chart-line text-white text-2xl"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">Bem-vindo ao FinanceFlow</h2>
                    <p class="text-gray-600 mt-2">Entre para gerenciar suas finan√ßas</p>
                </div>

                <!-- Google Login Button -->
                <button id="googleLoginBtn" class="google-btn w-full py-3 px-4 rounded-lg flex items-center justify-center space-x-3 mb-6">
                    <svg width="20" height="20" viewBox="0 0 24 24">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    <span class="text-gray-700 font-medium">Continuar com Google</span>
                </button>

                <div class="relative mb-6">
                    <div class="absolute inset-0 flex items-center">
                        <div class="w-full border-t border-gray-300"></div>
                    </div>
                    <div class="relative flex justify-center text-sm">
                        <span class="px-2 bg-white text-gray-500">ou</span>
                    </div>
                </div>

                <!-- Email/Password Form -->
                <form id="emailLoginForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" id="loginEmail" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="seu@email.com">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                        <div class="relative">
                            <input type="password" id="loginPassword" required class="w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                            <button type="button" class="password-toggle absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400" onclick="togglePasswordVisibility('loginPassword', this)">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    <button type="submit" id="loginBtn" class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-all font-medium">
                        Entrar
                    </button>
                </form>

                <div class="text-center mt-6">
                    <p class="text-gray-600">N√£o tem uma conta? 
                        <button onclick="showRegisterForm()" class="text-blue-600 hover:text-blue-700 font-medium transition-colors">Cadastre-se</button>
                    </p>
                </div>
            </div>

            <!-- Register Form -->
            <div id="registerForm" class="form-transition hidden">
                <div class="text-center mb-8">
                    <div class="w-16 h-16 bg-gradient-to-r from-green-600 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-user-plus text-white text-2xl"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">Criar Conta</h2>
                    <p class="text-gray-600 mt-2">Cadastre-se para come√ßar</p>
                </div>

                <form id="emailRegisterForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nome Completo</label>
                        <input type="text" id="registerName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Seu nome completo">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" id="registerEmail" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="seu@email.com">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                        <div class="relative">
                            <input type="password" id="registerPassword" required class="w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                            <button type="button" class="password-toggle absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400" onclick="togglePasswordVisibility('registerPassword', this)">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">M√≠nimo 6 caracteres</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Confirmar Senha</label>
                        <div class="relative">
                            <input type="password" id="confirmPassword" required class="w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                            <button type="button" class="password-toggle absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400" onclick="togglePasswordVisibility('confirmPassword', this)">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    <button type="submit" id="registerBtn" class="w-full bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 transition-all font-medium">
                        Criar Conta
                    </button>
                </form>

                <div class="text-center mt-6">
                    <p class="text-gray-600">J√° tem uma conta? 
                        <button onclick="showLoginForm()" class="text-blue-600 hover:text-blue-700 font-medium transition-colors">Fa√ßa login</button>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="appContainer" class="app-container hidden">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-6 py-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold flex items-center">
                        <i class="fas fa-chart-line mr-3"></i>
                        FinanceFlow
                    </h1>
                    <p class="text-blue-100 mt-2">Organize suas finan√ßas de forma inteligente</p>
                </div>
                <div class="text-right flex items-center space-x-4">
                    <div>
                        <p class="text-blue-100">Saldo Total</p>
                        <p class="text-2xl font-bold" id="totalBalance">R$ 0,00</p>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="text-right">
                            <p class="text-blue-100 text-sm">Ol√°,</p>
                            <p class="text-white font-medium" id="userDisplayName">Usu√°rio</p>
                        </div>
                        <button onclick="logout()" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white p-2 rounded-lg transition-all" title="Sair">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Navigation Tabs -->
            <div class="flex space-x-4 mt-6">
                <button class="nav-tab active px-6 py-3 rounded-lg text-white" onclick="showTab('dashboard')">
                    <i class="fas fa-home mr-2"></i>Dashboard
                </button>
                <button class="nav-tab px-6 py-3 rounded-lg text-blue-100 hover:text-white" onclick="showTab('analytics')">
                    <i class="fas fa-chart-bar mr-2"></i>Gr√°ficos
                </button>
                <button class="nav-tab px-6 py-3 rounded-lg text-blue-100 hover:text-white" onclick="showTab('calendar')">
                    <i class="fas fa-calendar mr-2"></i>Calend√°rio
                </button>
            </div>
        </div>
    </header>

    <!-- Dashboard Tab -->
    <div id="dashboardTab" class="tab-content">
        <!-- Lembretes Di√°rios -->
        <div id="dailyReminders" class="container mx-auto px-6 pt-8 pb-4">
            <!-- Lembretes ser√£o inseridos aqui -->
        </div>
        
        <!-- Dashboard Cards -->
        <div class="container mx-auto px-6 py-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <!-- Receitas Card -->
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover slide-in">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Receitas</p>
                            <p class="text-2xl font-bold text-green-600" id="totalIncome">R$ 0,00</p>
                        </div>
                        <div class="bg-green-100 p-3 rounded-full">
                            <i class="fas fa-arrow-up text-green-600 text-xl"></i>
                        </div>
                    </div>
                </div>

                <!-- Despesas Card -->
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover slide-in" style="animation-delay: 0.1s">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Despesas</p>
                            <p class="text-2xl font-bold text-red-600" id="totalExpenses">R$ 0,00</p>
                        </div>
                        <div class="bg-red-100 p-3 rounded-full">
                            <i class="fas fa-arrow-down text-red-600 text-xl"></i>
                        </div>
                    </div>
                </div>

                <!-- Contas Pagas Card -->
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover slide-in" style="animation-delay: 0.2s">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Contas Pagas</p>
                            <p class="text-2xl font-bold text-blue-600"><span id="paidCount">0</span>/<span id="totalCount">0</span></p>
                        </div>
                        <div class="bg-blue-100 p-3 rounded-full">
                            <i class="fas fa-check-circle text-blue-600 text-xl"></i>
                        </div>
                    </div>
                    <div class="mt-4">
                        <div class="bg-gray-200 rounded-full h-2">
                            <div class="bg-blue-600 h-2 rounded-full progress-bar" id="progressBar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filtros -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8 slide-in" style="animation-delay: 0.3s">
                <div class="flex flex-wrap gap-4 items-center">
                    <div class="flex items-center space-x-2">
                        <label class="text-sm font-medium text-gray-700">M√™s/Ano:</label>
                        <select id="monthYearFilter" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <!-- Op√ß√µes ser√£o preenchidas dinamicamente -->
                        </select>
                    </div>
                    <button class="filter-btn bg-blue-600 text-white px-4 py-2 rounded-lg transition-all hover:bg-blue-700" data-filter="all">
                        Todas
                    </button>
                    <button class="filter-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg transition-all hover:bg-gray-300" data-filter="pending">
                        Pendentes
                    </button>
                    <button class="filter-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg transition-all hover:bg-gray-300" data-filter="paid">
                        Pagas
                    </button>
                    <button class="filter-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg transition-all hover:bg-gray-300" data-filter="income">
                        Receitas
                    </button>
                    <button class="filter-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg transition-all hover:bg-gray-300" data-filter="expense">
                        Despesas
                    </button>
                </div>
            </div>

            <!-- Lista de Transa√ß√µes -->
            <div class="bg-white rounded-xl shadow-lg slide-in" style="animation-delay: 0.4s">
                <div class="p-6 border-b border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-800">Suas Finan√ßas</h2>
                </div>
                <div class="p-6">
                    <div id="transactionsList" class="space-y-4">
                        <!-- Transa√ß√µes ser√£o inseridas aqui -->
                    </div>
                    <div id="emptyState" class="text-center py-12">
                        <i class="fas fa-wallet text-gray-300 text-6xl mb-4"></i>
                        <p class="text-gray-500 text-lg">Nenhuma transa√ß√£o ainda</p>
                        <p class="text-gray-400">Clique no bot√£o + para adicionar sua primeira transa√ß√£o</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Analytics Tab -->
    <div id="analyticsTab" class="tab-content hidden">
        <div class="container mx-auto px-6 py-8">
            <!-- Barra de Pesquisa -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8 slide-in">
                <div class="flex flex-wrap gap-4 items-center">
                    <div class="flex-1 min-w-64">
                        <div class="relative">
                            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            <input type="text" id="searchInput" placeholder="Pesquisar por descri√ß√£o, categoria..." class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    <select id="analyticsYearFilter" class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        <option value="all">Todos os anos</option>
                    </select>
                    <select id="analyticsMonthFilter" class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        <option value="all">Todos os meses</option>
                    </select>
                </div>
            </div>

            <!-- Gr√°ficos -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <!-- Gr√°fico de Categorias -->
                <div class="bg-white rounded-xl shadow-lg p-6 slide-in">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Gastos por Categoria</h3>
                    <div class="chart-container">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>

                <!-- Gr√°fico Mensal -->
                <div class="bg-white rounded-xl shadow-lg p-6 slide-in">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Receitas vs Despesas por M√™s/Ano</h3>
                    <div class="chart-container">
                        <canvas id="monthlyChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Ranking de Meses -->
            <div class="bg-white rounded-xl shadow-lg p-6 slide-in">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">Ranking de Gastos por M√™s</h3>
                <div id="monthlyRanking" class="space-y-3">
                    <!-- Ranking ser√° inserido aqui -->
                </div>
            </div>
        </div>
    </div>

    <!-- Calendar Tab -->
    <div id="calendarTab" class="tab-content hidden">
        <div class="container mx-auto px-6 py-8">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Calend√°rio -->
                <div class="lg:col-span-2 bg-white rounded-xl shadow-lg p-6 slide-in">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-semibold text-gray-800">Calend√°rio Financeiro</h3>
                        <div class="flex items-center space-x-4">
                            <button onclick="previousMonth()" class="p-2 hover:bg-gray-100 rounded-lg">
                                <i class="fas fa-chevron-left text-gray-600"></i>
                            </button>
                            <span id="currentMonth" class="font-semibold text-gray-800"></span>
                            <button onclick="nextMonth()" class="p-2 hover:bg-gray-100 rounded-lg">
                                <i class="fas fa-chevron-right text-gray-600"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Legenda -->
                    <div class="flex items-center space-x-6 mb-4 text-sm">
                        <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                            <span class="text-gray-600">Despesas</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                            <span class="text-gray-600">Receitas</span>
                        </div>
                    </div>
                    
                    <div id="calendar" class="grid grid-cols-7 gap-1">
                        <!-- Calend√°rio ser√° inserido aqui -->
                    </div>
                </div>

                <!-- Transa√ß√µes do Dia Selecionado -->
                <div class="bg-white rounded-xl shadow-lg p-6 slide-in">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">
                        <span id="selectedDateTitle">Selecione um dia</span>
                    </h3>
                    <div id="dayTransactions" class="space-y-3">
                        <p class="text-gray-500 text-center py-8">Clique em um dia do calend√°rio para ver as transa√ß√µes</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bot√£o Flutuante -->
    <button class="floating-add bg-blue-600 text-white w-16 h-16 rounded-full shadow-lg flex items-center justify-center" onclick="openModal()">
        <i class="fas fa-plus text-xl"></i>
    </button>

    <!-- Modal Adicionar -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 transform transition-all">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-gray-800">Nova Transa√ß√£o</h3>
                    <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            <form id="transactionForm" class="p-6">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tipo</label>
                        <select id="type" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="expense">Despesa</option>
                            <option value="income">Receita</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Descri√ß√£o</label>
                        <input type="text" id="description" placeholder="Ex: Conta de luz, Sal√°rio..." class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Valor (R$)</label>
                        <input type="number" id="amount" step="0.01" placeholder="0,00" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Data de Vencimento</label>
                        <input type="date" id="dueDate" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Categoria</label>
                        <select id="category" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="alimentacao">üçΩÔ∏è Alimenta√ß√£o</option>
                            <option value="transporte">üöó Transporte</option>
                            <option value="moradia">üè† Moradia</option>
                            <option value="saude">üè• Sa√∫de</option>
                            <option value="educacao">üìö Educa√ß√£o</option>
                            <option value="lazer">üéÆ Lazer</option>
                            <option value="trabalho">üíº Trabalho</option>
                            <option value="salario">üí∞ Sal√°rio</option>
                            <option value="outros">üìã Outros</option>
                        </select>
                    </div>
                </div>
                <div class="flex gap-3 mt-6">
                    <button type="button" onclick="closeModal()" class="flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                        Cancelar
                    </button>
                    <button type="submit" class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        Adicionar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Editar -->
    <div id="editModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 transform transition-all">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-gray-800">Editar Transa√ß√£o</h3>
                    <button onclick="closeEditModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            <form id="editTransactionForm" class="p-6">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tipo</label>
                        <select id="editType" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="expense">Despesa</option>
                            <option value="income">Receita</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Descri√ß√£o</label>
                        <input type="text" id="editDescription" placeholder="Ex: Conta de luz, Sal√°rio..." class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Valor (R$)</label>
                        <input type="number" id="editAmount" step="0.01" placeholder="0,00" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Data de Vencimento</label>
                        <input type="date" id="editDueDate" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Categoria</label>
                        <select id="editCategory" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="alimentacao">üçΩÔ∏è Alimenta√ß√£o</option>
                            <option value="transporte">üöó Transporte</option>
                            <option value="moradia">üè† Moradia</option>
                            <option value="saude">üè• Sa√∫de</option>
                            <option value="educacao">üìö Educa√ß√£o</option>
                            <option value="lazer">üéÆ Lazer</option>
                            <option value="trabalho">üíº Trabalho</option>
                            <option value="salario">üí∞ Sal√°rio</option>
                            <option value="outros">üìã Outros</option>
                        </select>
                    </div>
                </div>
                <div class="flex gap-3 mt-6">
                    <button type="button" onclick="closeEditModal()" class="flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                        Cancelar
                    </button>
                    <button type="submit" class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        Salvar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
        let currentFilter = 'all';
        let selectedMonthYear = 'all';
        let currentCalendarDate = new Date();
        let selectedCalendarDate = null;
        let categoryChart = null;
        let monthlyChart = null;
        let editingTransactionId = null;

        // Definir data padr√£o como hoje
        document.getElementById('dueDate').valueAsDate = new Date();

        function saveTransactions() {
            localStorage.setItem('transactions', JSON.stringify(transactions));
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(amount);
        }

        function formatDate(dateString) {
            return new Date(dateString + 'T12:00:00').toLocaleDateString('pt-BR');
        }

        function getMonthYear(dateString) {
            const date = new Date(dateString + 'T12:00:00');
            return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
        }

        function getMonthYearDisplay(dateString) {
            const date = new Date(dateString + 'T12:00:00');
            const months = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 
                           'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            return `${months[date.getMonth()]} ${date.getFullYear()}`;
        }

        function showTab(tabName) {
            // Esconder todas as abas
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Mostrar aba selecionada
            document.getElementById(tabName + 'Tab').classList.remove('hidden');
            
            // Atualizar bot√µes de navega√ß√£o
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.add('text-blue-100', 'hover:text-white');
                btn.classList.remove('text-white');
            });
            
            event.target.classList.add('active');
            event.target.classList.remove('text-blue-100', 'hover:text-white');
            event.target.classList.add('text-white');
            
            // Inicializar conte√∫do espec√≠fico da aba
            if (tabName === 'analytics') {
                updateCharts();
                updateMonthlyRanking();
            } else if (tabName === 'calendar') {
                renderCalendar();
            }
        }

        function populateMonthYearFilters() {
            // Obter todos os anos e meses √∫nicos das transa√ß√µes
            const allYears = [...new Set(transactions.map(t => new Date(t.dueDate + 'T12:00:00').getFullYear()))].sort().reverse();
            const allMonthYears = [...new Set(transactions.map(t => getMonthYear(t.dueDate)))].sort().reverse();
            
            const months = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 
                           'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            
            const dashboardFilter = document.getElementById('monthYearFilter');
            const analyticsMonthFilter = document.getElementById('analyticsMonthFilter');
            const analyticsYearFilter = document.getElementById('analyticsYearFilter');
            
            // Limpar filtros
            dashboardFilter.innerHTML = '<option value="all">Todos os meses</option>';
            analyticsMonthFilter.innerHTML = '<option value="all">Todos os meses</option>';
            analyticsYearFilter.innerHTML = '<option value="all">Todos os anos</option>';
            
            // Popular filtro do dashboard com todos os meses/anos das transa√ß√µes
            allMonthYears.forEach(monthYear => {
                const display = getMonthYearDisplay(monthYear + '-01');
                dashboardFilter.innerHTML += `<option value="${monthYear}">${display}</option>`;
            });
            
            // Popular filtro de anos com todos os anos das transa√ß√µes
            allYears.forEach(year => {
                analyticsYearFilter.innerHTML += `<option value="${year}">${year}</option>`;
            });
            
            // Popular filtro de meses com todos os 12 meses
            months.forEach((month, index) => {
                analyticsMonthFilter.innerHTML += `<option value="${index + 1}">${month}</option>`;
            });
        }

        function openModal() {
            document.getElementById('modal').classList.remove('hidden');
            document.getElementById('description').focus();
        }

        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
            document.getElementById('transactionForm').reset();
            document.getElementById('dueDate').valueAsDate = new Date();
        }

        function addTransaction(e) {
            e.preventDefault();
            
            const transaction = {
                id: Date.now(),
                type: document.getElementById('type').value,
                description: document.getElementById('description').value,
                amount: parseFloat(document.getElementById('amount').value),
                dueDate: document.getElementById('dueDate').value,
                category: document.getElementById('category').value,
                paid: false,
                createdAt: new Date().toISOString()
            };

            transactions.unshift(transaction);
            saveTransactions();
            populateMonthYearFilters();
            updateDashboard();
            renderTransactions();
            renderDailyReminders();
            closeModal();

            showSuccessMessage('Transa√ß√£o adicionada com sucesso!');
        }

        function togglePaid(id) {
            const transaction = transactions.find(t => t.id === id);
            if (transaction) {
                transaction.paid = !transaction.paid;
                saveTransactions();
                updateDashboard();
                renderTransactions();
                renderDailyReminders();
                
                const element = document.querySelector(`[data-id="${id}"]`);
                if (element) {
                    element.classList.add('pulse-success');
                    setTimeout(() => element.classList.remove('pulse-success'), 600);
                }
            }
        }

        function deleteTransaction(id) {
            if (confirm('Tem certeza que deseja excluir esta transa√ß√£o?')) {
                transactions = transactions.filter(t => t.id !== id);
                saveTransactions();
                populateMonthYearFilters();
                updateDashboard();
                renderTransactions();
                renderDailyReminders();
                showSuccessMessage('Transa√ß√£o exclu√≠da!');
            }
        }

        function getFilteredTransactions() {
            let filtered = transactions;
            
            // Filtro por m√™s/ano
            if (selectedMonthYear !== 'all') {
                filtered = filtered.filter(t => getMonthYear(t.dueDate) === selectedMonthYear);
            }
            
            // Filtro por tipo
            if (currentFilter === 'pending') {
                filtered = filtered.filter(t => !t.paid);
            } else if (currentFilter === 'paid') {
                filtered = filtered.filter(t => t.paid);
            } else if (currentFilter === 'income') {
                filtered = filtered.filter(t => t.type === 'income');
            } else if (currentFilter === 'expense') {
                filtered = filtered.filter(t => t.type === 'expense');
            }
            
            return filtered;
        }

        function updateDashboard() {
            const filteredTransactions = getFilteredTransactions();
            
            const income = filteredTransactions
                .filter(t => t.type === 'income' && t.paid)
                .reduce((sum, t) => sum + t.amount, 0);
            
            const expenses = filteredTransactions
                .filter(t => t.type === 'expense' && t.paid)
                .reduce((sum, t) => sum + t.amount, 0);
            
            const balance = income - expenses;
            
            const totalTransactions = filteredTransactions.filter(t => t.type === 'expense').length;
            const paidTransactions = filteredTransactions.filter(t => t.type === 'expense' && t.paid).length;
            const progressPercentage = totalTransactions > 0 ? (paidTransactions / totalTransactions) * 100 : 0;

            document.getElementById('totalIncome').textContent = formatCurrency(income);
            document.getElementById('totalExpenses').textContent = formatCurrency(expenses);
            document.getElementById('totalBalance').textContent = formatCurrency(balance);
            document.getElementById('paidCount').textContent = paidTransactions;
            document.getElementById('totalCount').textContent = totalTransactions;
            document.getElementById('progressBar').style.width = progressPercentage + '%';

            const balanceElement = document.getElementById('totalBalance');
            balanceElement.className = balance >= 0 ? 'text-2xl font-bold text-green-400' : 'text-2xl font-bold text-red-400';
        }

        function renderTransactions() {
            const container = document.getElementById('transactionsList');
            const emptyState = document.getElementById('emptyState');
            
            const filteredTransactions = getFilteredTransactions();

            if (filteredTransactions.length === 0) {
                container.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }

            emptyState.classList.add('hidden');
            
            container.innerHTML = filteredTransactions.map(transaction => {
                const isOverdue = new Date(transaction.dueDate) < new Date() && !transaction.paid;
                const typeIcon = transaction.type === 'income' ? 'fa-arrow-up text-green-600' : 'fa-arrow-down text-red-600';
                const typeColor = transaction.type === 'income' ? 'text-green-600' : 'text-red-600';
                
                return `
                    <div class="expense-item ${transaction.paid ? 'paid' : ''} bg-gray-50 rounded-lg p-4 flex items-center justify-between fade-in" data-id="${transaction.id}">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 rounded-full ${transaction.type === 'income' ? 'bg-green-100' : 'bg-red-100'} flex items-center justify-center">
                                <i class="fas ${typeIcon}"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-800 expense-text">${transaction.description}</h3>
                                <div class="flex items-center space-x-2 text-sm text-gray-500">
                                    <span>${transaction.category}</span>
                                    <span>‚Ä¢</span>
                                    <span>Vence: ${formatDate(transaction.dueDate)}</span>
                                    ${isOverdue ? '<span class="text-red-500 font-medium">‚Ä¢ ATRASADO</span>' : ''}
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <span class="font-bold ${typeColor} expense-text">${formatCurrency(transaction.amount)}</span>
                            <button onclick="togglePaid(${transaction.id})" class="w-8 h-8 rounded-full border-2 ${transaction.paid ? 'bg-green-500 border-green-500' : 'border-gray-300 hover:border-green-500'} flex items-center justify-center transition-all">
                                ${transaction.paid ? '<i class="fas fa-check text-white text-sm"></i>' : ''}
                            </button>
                            <button onclick="editTransaction(${transaction.id})" class="text-gray-400 hover:text-blue-500 transition-colors mr-2">
                                <i class="fas fa-edit text-sm"></i>
                            </button>
                            <button onclick="deleteTransaction(${transaction.id})" class="text-gray-400 hover:text-red-500 transition-colors">
                                <i class="fas fa-trash text-sm"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function setFilter(filter) {
            currentFilter = filter;
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('bg-blue-600', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            document.querySelector(`[data-filter="${filter}"]`).classList.remove('bg-gray-200', 'text-gray-700');
            document.querySelector(`[data-filter="${filter}"]`).classList.add('bg-blue-600', 'text-white');
            
            updateDashboard();
            renderTransactions();
        }

        function updateCharts() {
            updateCategoryChart();
            updateMonthlyChart();
        }

        function updateCategoryChart() {
            const ctx = document.getElementById('categoryChart').getContext('2d');
            
            if (categoryChart) {
                categoryChart.destroy();
            }
            
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const analyticsYear = document.getElementById('analyticsYearFilter').value;
            const analyticsMonth = document.getElementById('analyticsMonthFilter').value;
            
            let filteredTransactions = transactions.filter(t => t.type === 'expense' && t.paid);
            
            if (analyticsYear !== 'all') {
                filteredTransactions = filteredTransactions.filter(t => new Date(t.dueDate + 'T12:00:00').getFullYear() == analyticsYear);
            }
            
            if (analyticsMonth !== 'all') {
                filteredTransactions = filteredTransactions.filter(t => new Date(t.dueDate + 'T12:00:00').getMonth() + 1 == analyticsMonth);
            }
            
            if (searchTerm) {
                filteredTransactions = filteredTransactions.filter(t => 
                    t.description.toLowerCase().includes(searchTerm) || 
                    t.category.toLowerCase().includes(searchTerm)
                );
            }
            
            const categoryData = {};
            const categoryLabels = {
                'alimentacao': 'üçΩÔ∏è Alimenta√ß√£o',
                'transporte': 'üöó Transporte',
                'moradia': 'üè† Moradia',
                'saude': 'üè• Sa√∫de',
                'educacao': 'üìö Educa√ß√£o',
                'lazer': 'üéÆ Lazer',
                'trabalho': 'üíº Trabalho',
                'salario': 'üí∞ Sal√°rio',
                'outros': 'üìã Outros'
            };
            
            filteredTransactions.forEach(t => {
                categoryData[t.category] = (categoryData[t.category] || 0) + t.amount;
            });
            
            const labels = Object.keys(categoryData).map(key => categoryLabels[key]);
            const data = Object.values(categoryData);
            const colors = ['#ef4444', '#f97316', '#eab308', '#22c55e', '#06b6d4', '#3b82f6', '#8b5cf6', '#ec4899'];
            
            if (data.length === 0) {
                // Mostrar gr√°fico vazio quando n√£o h√° dados
                categoryChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Nenhum dado'],
                        datasets: [{
                            data: [1],
                            backgroundColor: ['#e5e7eb'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                enabled: false
                            }
                        }
                    }
                });
                return;
            }
            
            categoryChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = formatCurrency(context.parsed);
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateMonthlyChart() {
            const ctx = document.getElementById('monthlyChart').getContext('2d');
            
            if (monthlyChart) {
                monthlyChart.destroy();
            }
            
            const analyticsYear = document.getElementById('analyticsYearFilter').value;
            const analyticsMonth = document.getElementById('analyticsMonthFilter').value;
            
            let filteredTransactions = transactions.filter(t => t.paid);
            
            // Aplicar filtros de ano e m√™s
            if (analyticsYear !== 'all') {
                filteredTransactions = filteredTransactions.filter(t => new Date(t.dueDate + 'T12:00:00').getFullYear() == analyticsYear);
            }
            
            if (analyticsMonth !== 'all') {
                filteredTransactions = filteredTransactions.filter(t => new Date(t.dueDate + 'T12:00:00').getMonth() + 1 == analyticsMonth);
            }
            
            const monthlyData = {};
            
            filteredTransactions.forEach(t => {
                const date = new Date(t.dueDate + 'T12:00:00');
                const year = date.getFullYear();
                const monthName = date.toLocaleDateString('pt-BR', { month: 'long' });
                const monthCapitalized = monthName.charAt(0).toUpperCase() + monthName.slice(1);
                const label = `${year} - ${monthCapitalized}`;
                
                if (!monthlyData[label]) {
                    monthlyData[label] = { income: 0, expense: 0 };
                }
                
                if (t.type === 'income') {
                    monthlyData[label].income += t.amount;
                } else {
                    monthlyData[label].expense += t.amount;
                }
            });
            
            // Ordenar por ano e m√™s
            const sortedEntries = Object.entries(monthlyData).sort((a, b) => {
                const [yearA, monthA] = a[0].split(' - ');
                const [yearB, monthB] = b[0].split(' - ');
                
                if (yearA !== yearB) {
                    return parseInt(yearA) - parseInt(yearB);
                }
                
                const months = ['janeiro', 'fevereiro', 'mar√ßo', 'abril', 'maio', 'junho',
                               'julho', 'agosto', 'setembro', 'outubro', 'novembro', 'dezembro'];
                return months.indexOf(monthA.toLowerCase()) - months.indexOf(monthB.toLowerCase());
            });
            
            const labels = sortedEntries.map(([label]) => label);
            const incomeData = sortedEntries.map(([, data]) => data.income);
            const expenseData = sortedEntries.map(([, data]) => data.expense);
            
            if (labels.length === 0) {
                // Mostrar gr√°fico vazio quando n√£o h√° dados
                monthlyChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Nenhum dado'],
                        datasets: [{
                            data: [1],
                            backgroundColor: ['#e5e7eb'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                enabled: false
                            }
                        },
                        scales: {
                            y: {
                                display: false
                            }
                        }
                    }
                });
                return;
            }
            
            monthlyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Receitas',
                            data: incomeData,
                            backgroundColor: '#22c55e',
                            borderColor: '#16a34a',
                            borderWidth: 1
                        },
                        {
                            label: 'Despesas',
                            data: expenseData,
                            backgroundColor: '#ef4444',
                            borderColor: '#dc2626',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.dataset.label || '';
                                    const value = formatCurrency(context.parsed.y);
                                    return `${label}: ${value}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    }
                }
            });
        }

        function getMonthIndex(monthName) {
            const months = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 
                           'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            return months.indexOf(monthName);
        }

        function updateMonthlyRanking() {
            const analyticsYear = document.getElementById('analyticsYearFilter').value;
            const analyticsMonth = document.getElementById('analyticsMonthFilter').value;
            
            let filteredTransactions = transactions.filter(t => t.type === 'expense' && t.paid);
            
            // Aplicar filtros de ano e m√™s
            if (analyticsYear !== 'all') {
                filteredTransactions = filteredTransactions.filter(t => new Date(t.dueDate + 'T12:00:00').getFullYear() == analyticsYear);
            }
            
            if (analyticsMonth !== 'all') {
                filteredTransactions = filteredTransactions.filter(t => new Date(t.dueDate + 'T12:00:00').getMonth() + 1 == analyticsMonth);
            }
            
            const monthlyTotals = {};
            
            filteredTransactions.forEach(t => {
                const monthYear = getMonthYearDisplay(t.dueDate);
                monthlyTotals[monthYear] = (monthlyTotals[monthYear] || 0) + t.amount;
            });
            
            const sortedMonths = Object.entries(monthlyTotals)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 10);
            
            const container = document.getElementById('monthlyRanking');
            
            if (sortedMonths.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">Nenhum dado dispon√≠vel</p>';
                return;
            }
            
            container.innerHTML = sortedMonths.map(([month, total], index) => `
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 rounded-full ${index < 3 ? 'bg-yellow-100 text-yellow-600' : 'bg-gray-100 text-gray-600'} flex items-center justify-center font-bold text-sm">
                            ${index + 1}
                        </div>
                        <span class="font-medium text-gray-800">${month}</span>
                    </div>
                    <span class="font-bold text-red-600">${formatCurrency(total)}</span>
                </div>
            `).join('');
        }

        function renderCalendar() {
            const calendar = document.getElementById('calendar');
            const currentMonthElement = document.getElementById('currentMonth');
            
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            const monthNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                               'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            
            currentMonthElement.textContent = `${monthNames[month]} ${year}`;
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            const dayNames = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];
            
            let calendarHTML = '';
            
            // Cabe√ßalho dos dias da semana
            dayNames.forEach(day => {
                calendarHTML += `<div class="p-2 text-center font-semibold text-gray-600 text-sm">${day}</div>`;
            });
            
            // Dias do calend√°rio
            for (let i = 0; i < 42; i++) {
                const currentDate = new Date(startDate);
                currentDate.setDate(startDate.getDate() + i);
                
                const isCurrentMonth = currentDate.getMonth() === month;
                const isToday = currentDate.toDateString() === new Date().toDateString();
                const isSelected = selectedCalendarDate && currentDate.toDateString() === selectedCalendarDate.toDateString();
                
                const dateString = currentDate.toISOString().split('T')[0];
                const dayTransactions = transactions.filter(t => t.dueDate === dateString);
                const hasExpenses = dayTransactions.some(t => t.type === 'expense');
                const hasIncome = dayTransactions.some(t => t.type === 'income');
                
                let classes = 'calendar-day p-3 text-center cursor-pointer rounded-lg relative';
                if (!isCurrentMonth) classes += ' text-gray-300';
                if (isToday) classes += ' bg-blue-100 text-blue-600 font-bold';
                if (isSelected) classes += ' selected';
                if (dayTransactions.length > 0) classes += ' has-transactions';
                
                let dots = '';
                if (hasExpenses) dots += '<div class="transaction-dot dot-expense"></div>';
                if (hasIncome) dots += '<div class="transaction-dot dot-income"></div>';
                
                calendarHTML += `
                    <div class="${classes}" onclick="selectCalendarDate('${dateString}')">
                        ${currentDate.getDate()}
                        ${dots}
                    </div>
                `;
            }
            
            calendar.innerHTML = calendarHTML;
        }

        function selectCalendarDate(dateString) {
            selectedCalendarDate = new Date(dateString + 'T12:00:00');
            renderCalendar();
            renderDayTransactions(dateString);
        }

        function renderDayTransactions(dateString) {
            const container = document.getElementById('dayTransactions');
            const titleElement = document.getElementById('selectedDateTitle');
            
            const dayTransactions = transactions.filter(t => t.dueDate === dateString);
            const formattedDate = new Date(dateString + 'T12:00:00').toLocaleDateString('pt-BR');
            
            titleElement.textContent = formattedDate;
            
            if (dayTransactions.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">Nenhuma transa√ß√£o neste dia</p>';
                return;
            }
            
            container.innerHTML = dayTransactions.map(transaction => {
                const typeIcon = transaction.type === 'income' ? 'fa-arrow-up text-green-600' : 'fa-arrow-down text-red-600';
                const typeColor = transaction.type === 'income' ? 'text-green-600' : 'text-red-600';
                
                return `
                    <div class="bg-gray-50 rounded-lg p-3">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <i class="fas ${typeIcon}"></i>
                                <div>
                                    <p class="font-medium text-gray-800 text-sm">${transaction.description}</p>
                                    <p class="text-xs text-gray-500">${transaction.category}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="font-bold ${typeColor} text-sm">${formatCurrency(transaction.amount)}</p>
                                <p class="text-xs ${transaction.paid ? 'text-green-600' : 'text-red-600'}">${transaction.paid ? 'Pago' : 'Pendente'}</p>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function previousMonth() {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
            renderCalendar();
        }

        function renderDailyReminders() {
            const container = document.getElementById('dailyReminders');
            const today = new Date().toISOString().split('T')[0];
            
            // Contas vencendo hoje
            const todayTransactions = transactions.filter(t => 
                t.dueDate === today && !t.paid
            );
            
            // Contas vencidas (at√© 7 dias atr√°s)
            const sevenDaysAgo = new Date();
            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
            const overdueTransactions = transactions.filter(t => {
                const dueDate = new Date(t.dueDate + 'T12:00:00');
                return dueDate < new Date(today + 'T12:00:00') && 
                       dueDate >= sevenDaysAgo && 
                       !t.paid;
            });
            
            // Contas vencendo nos pr√≥ximos 3 dias
            const threeDaysFromNow = new Date();
            threeDaysFromNow.setDate(threeDaysFromNow.getDate() + 3);
            const upcomingTransactions = transactions.filter(t => {
                const dueDate = new Date(t.dueDate + 'T12:00:00');
                const todayDate = new Date(today + 'T12:00:00');
                return dueDate > todayDate && 
                       dueDate <= threeDaysFromNow && 
                       !t.paid;
            });
            
            if (todayTransactions.length === 0 && overdueTransactions.length === 0 && upcomingTransactions.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            let remindersHTML = '<div class="space-y-4">';
            
            // Contas vencidas
            if (overdueTransactions.length > 0) {
                remindersHTML += `
                    <div class="bg-red-50 border-l-4 border-red-500 rounded-lg p-4 slide-in">
                        <div class="flex items-center mb-3">
                            <i class="fas fa-exclamation-triangle text-red-500 mr-2"></i>
                            <h3 class="text-lg font-semibold text-red-800">Contas Vencidas</h3>
                        </div>
                        <div class="space-y-2">
                            ${overdueTransactions.map(t => `
                                <div class="flex items-center justify-between bg-white rounded-lg p-3">
                                    <div>
                                        <p class="font-medium text-gray-800">${t.description}</p>
                                        <p class="text-sm text-gray-500">Venceu em ${formatDate(t.dueDate)} ‚Ä¢ ${formatCurrency(t.amount)}</p>
                                    </div>
                                    <div class="flex space-x-2">
                                        <button onclick="togglePaid(${t.id})" class="text-green-600 hover:text-green-700 text-sm">
                                            <i class="fas fa-check"></i> Pagar
                                        </button>
                                        <button onclick="editTransaction(${t.id})" class="text-blue-600 hover:text-blue-700 text-sm">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            // Contas vencendo hoje
            if (todayTransactions.length > 0) {
                remindersHTML += `
                    <div class="bg-yellow-50 border-l-4 border-yellow-500 rounded-lg p-4 slide-in">
                        <div class="flex items-center mb-3">
                            <i class="fas fa-clock text-yellow-500 mr-2"></i>
                            <h3 class="text-lg font-semibold text-yellow-800">Vencendo Hoje</h3>
                        </div>
                        <div class="space-y-2">
                            ${todayTransactions.map(t => `
                                <div class="flex items-center justify-between bg-white rounded-lg p-3">
                                    <div>
                                        <p class="font-medium text-gray-800">${t.description}</p>
                                        <p class="text-sm text-gray-500">${t.category} ‚Ä¢ ${formatCurrency(t.amount)}</p>
                                    </div>
                                    <div class="flex space-x-2">
                                        <button onclick="togglePaid(${t.id})" class="text-green-600 hover:text-green-700 text-sm">
                                            <i class="fas fa-check"></i> Pagar
                                        </button>
                                        <button onclick="editTransaction(${t.id})" class="text-blue-600 hover:text-blue-700 text-sm">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            // Contas vencendo em breve
            if (upcomingTransactions.length > 0) {
                remindersHTML += `
                    <div class="bg-blue-50 border-l-4 border-blue-500 rounded-lg p-4 slide-in">
                        <div class="flex items-center mb-3">
                            <i class="fas fa-calendar-alt text-blue-500 mr-2"></i>
                            <h3 class="text-lg font-semibold text-blue-800">Pr√≥ximos Vencimentos</h3>
                        </div>
                        <div class="space-y-2">
                            ${upcomingTransactions.map(t => `
                                <div class="flex items-center justify-between bg-white rounded-lg p-3">
                                    <div>
                                        <p class="font-medium text-gray-800">${t.description}</p>
                                        <p class="text-sm text-gray-500">Vence em ${formatDate(t.dueDate)} ‚Ä¢ ${formatCurrency(t.amount)}</p>
                                    </div>
                                    <div class="flex space-x-2">
                                        <button onclick="togglePaid(${t.id})" class="text-green-600 hover:text-green-700 text-sm">
                                            <i class="fas fa-check"></i> Pagar
                                        </button>
                                        <button onclick="editTransaction(${t.id})" class="text-blue-600 hover:text-blue-700 text-sm">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            remindersHTML += '</div>';
            container.innerHTML = remindersHTML;
        }

        function editTransaction(id) {
            const transaction = transactions.find(t => t.id === id);
            if (!transaction) return;
            
            editingTransactionId = id;
            
            // Preencher o formul√°rio de edi√ß√£o
            document.getElementById('editType').value = transaction.type;
            document.getElementById('editDescription').value = transaction.description;
            document.getElementById('editAmount').value = transaction.amount;
            document.getElementById('editDueDate').value = transaction.dueDate;
            document.getElementById('editCategory').value = transaction.category;
            
            // Mostrar modal de edi√ß√£o
            document.getElementById('editModal').classList.remove('hidden');
            document.getElementById('editDescription').focus();
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.add('hidden');
            document.getElementById('editTransactionForm').reset();
            editingTransactionId = null;
        }

        function updateTransaction(e) {
            e.preventDefault();
            
            if (!editingTransactionId) return;
            
            const transactionIndex = transactions.findIndex(t => t.id === editingTransactionId);
            if (transactionIndex === -1) return;
            
            // Atualizar a transa√ß√£o
            transactions[transactionIndex] = {
                ...transactions[transactionIndex],
                type: document.getElementById('editType').value,
                description: document.getElementById('editDescription').value,
                amount: parseFloat(document.getElementById('editAmount').value),
                dueDate: document.getElementById('editDueDate').value,
                category: document.getElementById('editCategory').value,
                updatedAt: new Date().toISOString()
            };
            
            saveTransactions();
            populateMonthYearFilters();
            updateDashboard();
            renderTransactions();
            renderDailyReminders();
            closeEditModal();
            
            showSuccessMessage('Transa√ß√£o atualizada com sucesso!');
        }

        function showSuccessMessage(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 fade-in';
            toast.innerHTML = `<i class="fas fa-check mr-2"></i>${message}`;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Event Listeners
        document.getElementById('transactionForm').addEventListener('submit', addTransaction);
        document.getElementById('editTransactionForm').addEventListener('submit', updateTransaction);

        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => setFilter(btn.dataset.filter));
        });

        document.getElementById('monthYearFilter').addEventListener('change', (e) => {
            selectedMonthYear = e.target.value;
            updateDashboard();
            renderTransactions();
        });

        document.getElementById('analyticsMonthFilter').addEventListener('change', () => {
            updateCharts();
            updateMonthlyRanking();
        });

        document.getElementById('analyticsYearFilter').addEventListener('change', () => {
            updateCharts();
            updateMonthlyRanking();
        });

        document.getElementById('searchInput').addEventListener('input', () => {
            updateCharts();
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
                closeEditModal();
            }
        });

        document.getElementById('modal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('modal')) closeModal();
        });

        document.getElementById('editModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('editModal')) closeEditModal();
        });

        // Inicializar
        populateMonthYearFilters();
        updateDashboard();
        renderTransactions();
        renderDailyReminders();
        renderCalendar();
    </script>
    </div> <!-- Fechamento do appContainer -->

    <script>
        // Vari√°veis globais para Firebase
        let currentUser = null;
        let unsubscribeTransactions = null;

        // Fun√ß√£o para alternar visibilidade da senha
        function togglePasswordVisibility(inputId, button) {
            const input = document.getElementById(inputId);
            const icon = button.querySelector('i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        // Fun√ß√£o para mostrar formul√°rio de registro
        function showRegisterForm() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
        }

        // Fun√ß√£o para mostrar formul√°rio de login
        function showLoginForm() {
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
        }

        // Fun√ß√£o para mostrar mensagens de erro/sucesso
        function showMessage(message, type = 'success') {
            const toast = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
            const icon = type === 'success' ? 'fa-check' : 'fa-exclamation-triangle';
            
            toast.className = `fixed top-4 right-4 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg z-50 fade-in`;
            toast.innerHTML = `<i class="fas ${icon} mr-2"></i>${message}`;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 4000);
        }

        // Fun√ß√£o para definir estado de loading nos bot√µes
        function setButtonLoading(buttonId, loading) {
            const button = document.getElementById(buttonId);
            if (loading) {
                button.classList.add('btn-loading');
                button.disabled = true;
            } else {
                button.classList.remove('btn-loading');
                button.disabled = false;
            }
        }

        // Login com Google
        document.getElementById('googleLoginBtn').addEventListener('click', async () => {
            setButtonLoading('googleLoginBtn', true);
            
            try {
                const provider = new GoogleAuthProvider();
                const result = await signInWithPopup(auth, provider);
                showMessage('Login realizado com sucesso!');
            } catch (error) {
                console.error('Erro no login com Google:', error);
                showMessage('Erro ao fazer login com Google: ' + error.message, 'error');
            } finally {
                setButtonLoading('googleLoginBtn', false);
            }
        });

        // Login com email/senha
        document.getElementById('emailLoginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            setButtonLoading('loginBtn', true);
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                await signInWithEmailAndPassword(auth, email, password);
                showMessage('Login realizado com sucesso!');
            } catch (error) {
                console.error('Erro no login:', error);
                let errorMessage = 'Erro ao fazer login';
                
                switch (error.code) {
                    case 'auth/user-not-found':
                        errorMessage = 'Usu√°rio n√£o encontrado';
                        break;
                    case 'auth/wrong-password':
                        errorMessage = 'Senha incorreta';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Email inv√°lido';
                        break;
                    case 'auth/too-many-requests':
                        errorMessage = 'Muitas tentativas. Tente novamente mais tarde';
                        break;
                    default:
                        errorMessage = error.message;
                }
                
                showMessage(errorMessage, 'error');
            } finally {
                setButtonLoading('loginBtn', false);
            }
        });

        // Registro com email/senha
        document.getElementById('emailRegisterForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            setButtonLoading('registerBtn', true);
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // Valida√ß√µes
            if (password !== confirmPassword) {
                showMessage('As senhas n√£o coincidem', 'error');
                setButtonLoading('registerBtn', false);
                return;
            }
            
            if (password.length < 6) {
                showMessage('A senha deve ter pelo menos 6 caracteres', 'error');
                setButtonLoading('registerBtn', false);
                return;
            }
            
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                await updateProfile(userCredential.user, { displayName: name });
                showMessage('Conta criada com sucesso!');
            } catch (error) {
                console.error('Erro no registro:', error);
                let errorMessage = 'Erro ao criar conta';
                
                switch (error.code) {
                    case 'auth/email-already-in-use':
                        errorMessage = 'Este email j√° est√° em uso';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Email inv√°lido';
                        break;
                    case 'auth/weak-password':
                        errorMessage = 'Senha muito fraca';
                        break;
                    default:
                        errorMessage = error.message;
                }
                
                showMessage(errorMessage, 'error');
            } finally {
                setButtonLoading('registerBtn', false);
            }
        });

        // Fun√ß√£o de logout
        async function logout() {
            try {
                if (unsubscribeTransactions) {
                    unsubscribeTransactions();
                }
                await signOut(auth);
                showMessage('Logout realizado com sucesso!');
            } catch (error) {
                console.error('Erro no logout:', error);
                showMessage('Erro ao fazer logout', 'error');
            }
        }

        // Fun√ß√£o para carregar transa√ß√µes do Firebase
        async function loadTransactionsFromFirebase() {
            if (!currentUser) return;
            
            try {
                const transactionsRef = collection(db, 'users', currentUser.uid, 'events');
                const q = query(transactionsRef, orderBy('createdAt', 'desc'));
                
                // Listener em tempo real
                unsubscribeTransactions = onSnapshot(q, (snapshot) => {
                    transactions = [];
                    snapshot.forEach((doc) => {
                        transactions.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    populateMonthYearFilters();
                    updateDashboard();
                    renderTransactions();
                    renderDailyReminders();
                    renderCalendar();
                });
                
            } catch (error) {
                console.error('Erro ao carregar transa√ß√µes:', error);
                showMessage('Erro ao carregar dados', 'error');
            }
        }

        // Fun√ß√£o para salvar transa√ß√£o no Firebase
        async function saveTransactionToFirebase(transaction) {
            if (!currentUser) return;
            
            try {
                const transactionsRef = collection(db, 'users', currentUser.uid, 'events');
                await addDoc(transactionsRef, transaction);
            } catch (error) {
                console.error('Erro ao salvar transa√ß√£o:', error);
                showMessage('Erro ao salvar transa√ß√£o', 'error');
            }
        }

        // Fun√ß√£o para atualizar transa√ß√£o no Firebase
        async function updateTransactionInFirebase(transactionId, updates) {
            if (!currentUser) return;
            
            try {
                const transactionRef = doc(db, 'users', currentUser.uid, 'events', transactionId);
                await updateDoc(transactionRef, updates);
            } catch (error) {
                console.error('Erro ao atualizar transa√ß√£o:', error);
                showMessage('Erro ao atualizar transa√ß√£o', 'error');
            }
        }

        // Fun√ß√£o para deletar transa√ß√£o do Firebase
        async function deleteTransactionFromFirebase(transactionId) {
            if (!currentUser) return;
            
            try {
                const transactionRef = doc(db, 'users', currentUser.uid, 'events', transactionId);
                await deleteDoc(transactionRef);
            } catch (error) {
                console.error('Erro ao deletar transa√ß√£o:', error);
                showMessage('Erro ao deletar transa√ß√£o', 'error');
            }
        }

        // Atualizar as fun√ß√µes existentes para usar Firebase
        const originalAddTransaction = addTransaction;
        addTransaction = async function(e) {
            e.preventDefault();
            
            const transaction = {
                type: document.getElementById('type').value,
                description: document.getElementById('description').value,
                amount: parseFloat(document.getElementById('amount').value),
                dueDate: document.getElementById('dueDate').value,
                category: document.getElementById('category').value,
                paid: false,
                createdAt: new Date().toISOString()
            };

            await saveTransactionToFirebase(transaction);
            closeModal();
            showSuccessMessage('Transa√ß√£o adicionada com sucesso!');
        };

        const originalTogglePaid = togglePaid;
        togglePaid = async function(id) {
            const transaction = transactions.find(t => t.id === id);
            if (transaction) {
                const updates = { paid: !transaction.paid };
                await updateTransactionInFirebase(id, updates);
                
                const element = document.querySelector(`[data-id="${id}"]`);
                if (element) {
                    element.classList.add('pulse-success');
                    setTimeout(() => element.classList.remove('pulse-success'), 600);
                }
            }
        };

        const originalDeleteTransaction = deleteTransaction;
        deleteTransaction = async function(id) {
            if (confirm('Tem certeza que deseja excluir esta transa√ß√£o?')) {
                await deleteTransactionFromFirebase(id);
                showSuccessMessage('Transa√ß√£o exclu√≠da!');
            }
        };

        const originalUpdateTransaction = updateTransaction;
        updateTransaction = async function(e) {
            e.preventDefault();
            
            if (!editingTransactionId) return;
            
            const updates = {
                type: document.getElementById('editType').value,
                description: document.getElementById('editDescription').value,
                amount: parseFloat(document.getElementById('editAmount').value),
                dueDate: document.getElementById('editDueDate').value,
                category: document.getElementById('editCategory').value,
                updatedAt: new Date().toISOString()
            };
            
            await updateTransactionInFirebase(editingTransactionId, updates);
            closeEditModal();
            showSuccessMessage('Transa√ß√£o atualizada com sucesso!');
        };

        // Atualizar categoryLabels para incluir sal√°rio
        const categoryLabels = {
            'alimentacao': 'üçΩÔ∏è Alimenta√ß√£o',
            'transporte': 'üöó Transporte',
            'moradia': 'üè† Moradia',
            'saude': 'üè• Sa√∫de',
            'educacao': 'üìö Educa√ß√£o',
            'lazer': 'üéÆ Lazer',
            'trabalho': 'üíº Trabalho',
            'salario': 'üí∞ Sal√°rio',
            'outros': 'üìã Outros'
        };

        // Listener para mudan√ßas de autentica√ß√£o
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                
                // Mostrar nome do usu√°rio
                const displayName = user.displayName || user.email.split('@')[0];
                document.getElementById('userDisplayName').textContent = displayName;
                
                // Esconder tela de login e mostrar app
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('appContainer').classList.remove('hidden');
                
                // Carregar transa√ß√µes do usu√°rio
                loadTransactionsFromFirebase();
                
            } else {
                currentUser = null;
                
                // Limpar dados locais
                transactions = [];
                if (unsubscribeTransactions) {
                    unsubscribeTransactions();
                }
                
                // Mostrar tela de login e esconder app
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('appContainer').classList.add('hidden');
            }
        });

        // Remover inicializa√ß√£o local (agora ser√° feita ap√≥s login)
        // populateMonthYearFilters();
        // updateDashboard();
        // renderTransactions();
        // renderDailyReminders();
        // renderCalendar();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96d804d7506e9414',t:'MTc1NDkxODMwNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#6366f1">
    <title>FinanceWay</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    screens: {
                        'xs': '475px',
                    }
                }
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-analytics.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, collection, getDocs, deleteDoc, addDoc, onSnapshot, query, orderBy } from 'https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js';

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBhRH760_hAthw737CrzmioyZrzCeK5H8s",
            authDomain: "calendario-53e49.firebaseapp.com",
            projectId: "calendario-53e49",
            storageBucket: "calendario-53e49.firebasestorage.app",
            messagingSenderId: "352958232134",
            appId: "1:352958232134:web:0775e16be712522b59bc47",
            measurementId: "G-8FYM5H6LCT"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        window.auth = getAuth(app);
        window.db = getFirestore(app);
        window.currentUser = null;
        window.googleProvider = new GoogleAuthProvider();

        // Disponibilizar fun√ß√µes globalmente
        window.signInWithEmailAndPassword = signInWithEmailAndPassword;
        window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
        window.signInWithPopup = signInWithPopup;
        window.GoogleAuthProvider = GoogleAuthProvider;
        window.signOut = signOut;
        window.onAuthStateChanged = onAuthStateChanged;
        window.doc = doc;
        window.setDoc = setDoc;
        window.getDoc = getDoc;
        window.collection = collection;
        window.getDocs = getDocs;
        window.deleteDoc = deleteDoc;
        window.addDoc = addDoc;
        window.onSnapshot = onSnapshot;
        window.query = query;
        window.orderBy = orderBy;
    </script>
    
    <style>
        .calendar-day {
            position: relative;
        }
        .transaction-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            position: absolute;
            top: 2px;
        }
        .expense-dot { background-color: #ef4444; }
        .income-dot { background-color: #10b981; }
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tab-content {
            transition: opacity 0.3s ease-in-out;
        }
        
        /* Mobile-first optimizations */
        @media (max-width: 768px) {
            /* Disable hover effects on mobile for better performance */
            .hover\:scale-105:hover,
            .hover\:scale-102:hover,
            .hover\:scale-110:hover,
            .transform:hover,
            .hover-lift:hover {
                transform: none !important;
            }
            
            .hover\:shadow-lg:hover,
            .hover\:shadow-xl:hover,
            .hover\:shadow-md:hover,
            .hover\:shadow-2xl:hover {
                box-shadow: none !important;
            }
            
            /* Keep backdrop blur for visual hierarchy */
            .backdrop-blur-sm {
                backdrop-filter: blur(4px) !important;
            }
            
            /* Optimize transitions for mobile */
            .transition-all {
                transition: background-color 0.2s ease, opacity 0.2s ease !important;
            }
            
            /* Mobile-specific component styles */
            .mobile-card {
                border-radius: 16px;
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
                margin-bottom: 16px;
            }
            
            .mobile-button {
                min-height: 44px;
                min-width: 44px;
                padding: 12px 16px;
                font-size: 16px;
                border-radius: 12px;
            }
            
            .mobile-text {
                font-size: 16px !important;
                line-height: 1.5;
            }
            
            /* Prevent zoom on input focus - critical for mobile UX */
            input, select, textarea, button {
                font-size: 16px !important;
                -webkit-appearance: none;
                border-radius: 12px;
            }
            
            /* Enhanced touch targets */
            .touch-target {
                min-height: 44px;
                min-width: 44px;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 8px;
            }
            
            /* Mobile navigation improvements */
            .tab-btn {
                padding: 12px 8px !important;
                font-size: 14px !important;
                min-height: 48px;
            }
            
            /* Mobile form improvements */
            .form-input-mobile {
                padding: 16px 12px;
                font-size: 16px;
                border-radius: 12px;
                border: 2px solid rgba(255, 255, 255, 0.3);
            }
            
            /* Mobile modal improvements */
            .mobile-modal {
                margin: 16px;
                max-height: calc(100vh - 32px);
                border-radius: 20px;
            }
            
            /* Mobile calendar optimizations */
            .calendar-mobile {
                font-size: 14px;
            }
            
            .calendar-day-mobile {
                min-height: 50px;
                padding: 4px;
                font-size: 12px;
            }
            
            /* Mobile transaction list */
            .transaction-mobile {
                padding: 16px;
                margin-bottom: 8px;
                border-radius: 16px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
            
            /* Mobile dashboard cards */
            .dashboard-card-mobile {
                padding: 20px 16px;
                border-radius: 16px;
                margin-bottom: 16px;
            }
            
            /* Mobile header adjustments */
            .header-mobile {
                padding: 16px;
            }
            
            /* Mobile success message */
            .success-mobile {
                bottom: 20px;
                left: 16px;
                right: 16px;
                margin: 0;
                transform: none;
                border-radius: 16px;
                padding: 16px;
                font-size: 16px;
            }
        }
        
        /* Tablet optimizations */
        @media (min-width: 769px) and (max-width: 1024px) {
            .tablet-optimized {
                padding: 24px;
            }
            
            .mobile-text {
                font-size: 18px;
            }
        }
        
        .animate-pulse-slow {
            animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        .animate-bounce-slow {
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        /* Swipe feedback animation */
        .swipe-feedback {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Tab transition improvements */
        .tab-content {
            transition: opacity 0.3s ease-in-out, transform 0.2s ease-out;
        }
        
        .tab-content.hidden {
            transform: translateX(10px);
        }

        .completed-transaction {
            text-decoration: line-through;
            opacity: 0.7;
        }

        .login-container {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
        
        /* Loading state */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
        
        /* Success animation */
        .success-pulse {
            animation: successPulse 0.6s ease-out;
        }
        
        @keyframes successPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 min-h-screen">
    
    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="login-container rounded-2xl p-6 sm:p-8 w-full max-w-md mobile-modal border border-white/20 shadow-2xl">
            <div class="text-center mb-8">
                <div class="bg-white/20 p-4 rounded-full w-20 h-20 mx-auto mb-4 flex items-center justify-center">
                    <i class="fas fa-wallet text-yellow-300 text-3xl"></i>
                </div>
                <h2 class="text-3xl font-bold text-white mb-2">FinanceWay</h2>
                <p class="text-white/70">Entre na sua conta para continuar</p>
            </div>
            
            <div class="space-y-4">
                <button onclick="signInWithGoogle()" class="w-full bg-gradient-to-r from-red-500 to-red-600 text-white font-bold py-3 px-6 rounded-xl hover:from-red-400 hover:to-red-500 transition-all duration-300 transform hover:scale-105 shadow-lg">
                    <i class="fab fa-google mr-2"></i>Entrar com Google
                </button>
                <div class="flex items-center my-4">
                    <div class="flex-1 border-t border-white/30"></div>
                    <span class="px-4 text-white/70 text-sm">ou</span>
                    <div class="flex-1 border-t border-white/30"></div>
                </div>
                <button onclick="showLoginForm()" id="loginBtn" class="w-full bg-gradient-to-r from-indigo-500 to-purple-600 text-white font-bold py-3 px-6 rounded-xl hover:from-indigo-400 hover:to-purple-500 transition-all duration-300 transform hover:scale-105">
                    <i class="fas fa-sign-in-alt mr-2"></i>Entrar com Email
                </button>
                <button onclick="showRegisterForm()" id="registerBtn" class="w-full bg-gradient-to-r from-green-500 to-teal-600 text-white font-bold py-3 px-6 rounded-xl hover:from-green-400 hover:to-teal-500 transition-all duration-300 transform hover:scale-105">
                    <i class="fas fa-user-plus mr-2"></i>Criar Conta
                </button>
            </div>

            <!-- Login Form -->
            <form id="loginForm" class="hidden space-y-4 mt-6">
                <div>
                    <input type="email" id="loginEmail" placeholder="Email" class="w-full px-4 py-3 bg-white/20 backdrop-blur-sm border border-white/30 rounded-xl text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-yellow-300" required>
                </div>
                <div>
                    <input type="password" id="loginPassword" placeholder="Senha" class="w-full px-4 py-3 bg-white/20 backdrop-blur-sm border border-white/30 rounded-xl text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-yellow-300" required>
                </div>
                <button type="submit" class="w-full bg-gradient-to-r from-indigo-500 to-purple-600 text-white font-bold py-3 px-6 rounded-xl hover:from-indigo-400 hover:to-purple-500 transition-all duration-300">
                    Entrar
                </button>
                <button type="button" onclick="hideLoginForm()" class="w-full text-white/70 hover:text-white transition-all duration-300">
                    Voltar
                </button>
            </form>

            <!-- Register Form -->
            <form id="registerForm" class="hidden space-y-4 mt-6">
                <div>
                    <input type="email" id="registerEmail" placeholder="Email" class="w-full px-4 py-3 bg-white/20 backdrop-blur-sm border border-white/30 rounded-xl text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-yellow-300" required>
                </div>
                <div>
                    <input type="password" id="registerPassword" placeholder="Senha (m√≠n. 6 caracteres)" class="w-full px-4 py-3 bg-white/20 backdrop-blur-sm border border-white/30 rounded-xl text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-yellow-300" required>
                </div>
                <button type="submit" class="w-full bg-gradient-to-r from-green-500 to-teal-600 text-white font-bold py-3 px-6 rounded-xl hover:from-green-400 hover:to-teal-500 transition-all duration-300">
                    Criar Conta
                </button>
                <button type="button" onclick="hideRegisterForm()" class="w-full text-white/70 hover:text-white transition-all duration-300">
                    Voltar
                </button>
            </form>
        </div>
    </div>

    <!-- Header -->
    <header id="mainHeader" class="bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 shadow-2xl transition-all duration-500">
        <div class="container mx-auto px-4 py-4 sm:px-6 sm:py-6 header-mobile">
            <!-- Mobile Layout -->
            <div class="block lg:hidden">
                <div class="flex items-center justify-between mb-4">
                    <h1 class="text-xl sm:text-2xl font-bold text-white flex items-center mobile-text">
                        <div class="bg-white/20 p-2 rounded-full mr-3">
                            <i class="fas fa-wallet text-yellow-300 text-lg sm:text-xl"></i>
                        </div>
                        <span class="bg-gradient-to-r from-yellow-300 to-orange-300 bg-clip-text text-transparent">
                            FinanceWay
                        </span>
                    </h1>
                    <div id="userInfoMobile" class="hidden bg-white/10 backdrop-blur-sm rounded-xl p-3 border border-white/20">
                        <button onclick="logout()" class="text-sm text-white/70 hover:text-white mobile-button touch-target">
                            <i class="fas fa-sign-out-alt mr-2"></i>Sair
                        </button>
                    </div>
                </div>
                <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-4 sm:p-6 border border-white/20 text-center mobile-card">
                    <div class="flex items-center justify-center space-x-2 mb-3">
                        <p class="text-sm text-white/80 font-medium mobile-text">üí∞ Saldo de</p>
                        <input type="month" id="balanceMonthMobile" class="bg-white/20 border border-white/30 rounded-lg px-2 py-1 text-white text-xs focus:outline-none focus:ring-2 focus:ring-yellow-300" onchange="updateBalanceDisplay()">
                    </div>
                    <p id="currentBalanceMobile" class="text-2xl sm:text-3xl font-bold text-white mt-2">R$ 0,00</p>
                    <p class="text-xs text-white/60 mt-2" id="currentMonthLabelMobile"></p>
                </div>
            </div>
            
            <!-- Desktop Layout -->
            <div class="hidden lg:flex items-center justify-between">
                <h1 class="text-4xl font-bold text-white flex items-center">
                    <div class="bg-white/20 p-3 rounded-full mr-4">
                        <i class="fas fa-wallet text-yellow-300 text-2xl"></i>
                    </div>
                    <span class="bg-gradient-to-r from-yellow-300 to-orange-300 bg-clip-text text-transparent">
                        FinanceWay
                    </span>
                </h1>
                <div class="flex items-center space-x-4">
                    <div class="text-right bg-white/10 backdrop-blur-sm rounded-2xl p-4 border border-white/20">
                        <div class="flex items-center justify-end space-x-2 mb-2">
                            <p class="text-sm text-white/80 font-medium">üí∞ Saldo de</p>
                            <input type="month" id="balanceMonth" class="bg-white/20 border border-white/30 rounded-lg px-2 py-1 text-white text-sm focus:outline-none focus:ring-2 focus:ring-yellow-300" onchange="updateBalanceDisplay()">
                        </div>
                        <p id="currentBalance" class="text-3xl font-bold text-white">R$ 0,00</p>
                        <p class="text-xs text-white/60 mt-1" id="currentMonthLabel"></p>
                    </div>
                    <div id="userInfo" class="hidden bg-white/10 backdrop-blur-sm rounded-2xl p-4 border border-white/20">
                        <p class="text-sm text-white/80">Usu√°rio:</p>
                        <p id="userEmail" class="text-white font-semibold"></p>
                        <button onclick="logout()" class="text-xs text-white/70 hover:text-white mt-1 block">
                            <i class="fas fa-sign-out-alt mr-1"></i>Sair
                        </button>

                    </div>
                </div>
            </div>
        </div>
    </header>

    <div id="mainContent" class="container mx-auto px-4 py-4 sm:px-6 sm:py-8 transition-all duration-500">
        <!-- Navigation Tabs -->
        <div class="bg-white/10 backdrop-blur-sm rounded-2xl shadow-xl mb-4 sm:mb-8 border border-white/20 mobile-card">
            <div class="flex p-2 gap-1 sm:gap-2">
                <button onclick="showTab('transactions', 0)" class="tab-btn flex-1 px-2 py-3 sm:px-6 sm:py-4 font-bold text-white bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl shadow-lg transition-all duration-300 text-sm sm:text-base mobile-button touch-target">
                    <i class="fas fa-list mr-1 sm:mr-2 text-base"></i>
                    <span class="hidden xs:inline">Transa√ß√µes</span>
                    <span class="xs:hidden">Trans.</span>
                </button>
                <button onclick="showTab('dashboard', 1)" class="tab-btn flex-1 px-2 py-3 sm:px-6 sm:py-4 font-semibold text-white/70 hover:text-white hover:bg-white/20 rounded-xl transition-all duration-300 text-sm sm:text-base mobile-button touch-target">
                    <i class="fas fa-chart-pie mr-1 sm:mr-2 text-base"></i>
                    <span class="hidden xs:inline">Dashboard</span>
                    <span class="xs:hidden">Dash</span>
                </button>
                <button onclick="showTab('calendar', 2)" class="tab-btn flex-1 px-2 py-3 sm:px-6 sm:py-4 font-semibold text-white/70 hover:text-white hover:bg-white/20 rounded-xl transition-all duration-300 text-sm sm:text-base mobile-button touch-target">
                    <i class="fas fa-calendar mr-1 sm:mr-2 text-base"></i>
                    <span class="hidden xs:inline">Calend√°rio</span>
                    <span class="xs:hidden">Cal.</span>
                </button>
            </div>
        </div>

        <!-- Transactions Tab -->
        <div id="transactions" class="tab-content fade-in">
            <!-- Reminders -->
            <div id="reminders" class="mb-6">
                <!-- Reminders will be populated here -->
            </div>
            
            <!-- Add Transaction Form -->
            <div class="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-2xl shadow-xl p-4 sm:p-8 mb-4 sm:mb-8 mobile-card">
                <h3 class="text-lg sm:text-2xl font-bold text-white mb-4 sm:mb-6 flex items-center">
                    <i class="fas fa-plus-circle mr-2 sm:mr-3 text-yellow-300"></i>
                    Nova Transa√ß√£o
                </h3>
                <form id="transactionForm" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6">
                    <div class="space-y-2">
                        <label class="block text-sm font-semibold text-white mobile-text">Descri√ß√£o</label>
                        <input type="text" id="description" class="w-full px-4 py-4 bg-white/20 backdrop-blur-sm border border-white/30 rounded-xl text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-yellow-300 focus:border-transparent transition-all duration-300 mobile-text form-input-mobile" placeholder="Ex: Compra no supermercado" required>
                    </div>
                    <div class="space-y-2">
                        <label class="block text-sm font-semibold text-white mobile-text">Valor</label>
                        <input type="number" id="amount" step="0.01" class="w-full px-4 py-4 bg-white/20 backdrop-blur-sm border border-white/30 rounded-xl text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-yellow-300 focus:border-transparent transition-all duration-300 mobile-text form-input-mobile" placeholder="0,00" required>
                    </div>
                    <div class="space-y-2">
                        <label class="block text-sm font-semibold text-white mobile-text">Tipo</label>
                        <select id="type" class="w-full px-4 py-4 bg-white/20 backdrop-blur-sm border border-white/30 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-yellow-300 focus:border-transparent transition-all duration-300 mobile-text form-input-mobile">
                            <option value="income" class="text-gray-800">üí∞ Receita</option>
                            <option value="expense" class="text-gray-800">üí∏ Despesa</option>
                        </select>
                    </div>
                    <div class="space-y-2">
                        <label class="block text-sm font-semibold text-white mobile-text">Categoria</label>
                        <select id="category" class="w-full px-4 py-3 bg-white/20 backdrop-blur-sm border border-white/30 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-yellow-300 focus:border-transparent transition-all duration-300 mobile-text">
                            <option value="alimentacao" class="text-gray-800">üçΩÔ∏è Alimenta√ß√£o</option>
                            <option value="transporte" class="text-gray-800">üöó Transporte</option>
                            <option value="moradia" class="text-gray-800">üè† Moradia</option>
                            <option value="saude" class="text-gray-800">üè• Sa√∫de</option>
                            <option value="educacao" class="text-gray-800">üìö Educa√ß√£o</option>
                            <option value="lazer" class="text-gray-800">üéÆ Lazer</option>
                            <option value="salario" class="text-gray-800">üíº Sal√°rio</option>
                            <option value="freelance" class="text-gray-800">üíª Freelance</option>
                            <option value="investimentos" class="text-gray-800">üìà Investimentos</option>
                            <option value="outros" class="text-gray-800">üì¶ Outros</option>
                        </select>
                    </div>
                    <div class="space-y-2">
                        <label class="block text-sm font-semibold text-white mobile-text">Data</label>
                        <input type="date" id="date" class="w-full px-4 py-3 bg-white/20 backdrop-blur-sm border border-white/30 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-yellow-300 focus:border-transparent transition-all duration-300 mobile-text" required>
                    </div>
                    <div class="space-y-2">
                        <label class="block text-sm font-semibold text-white mobile-text">Prioridade</label>
                        <select id="priority" class="w-full px-4 py-3 bg-white/20 backdrop-blur-sm border border-white/30 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-yellow-300 focus:border-transparent transition-all duration-300 mobile-text">
                            <option value="baixa" class="text-gray-800">üü¢ Baixa</option>
                            <option value="media" class="text-gray-800">üü° M√©dia</option>
                            <option value="alta" class="text-gray-800">üî¥ Alta</option>
                        </select>
                    </div>
                    <div class="space-y-2">
                        <label class="block text-sm font-semibold text-white mobile-text">Observa√ß√µes</label>
                        <input type="text" id="observations" maxlength="50" class="w-full px-4 py-3 bg-white/20 backdrop-blur-sm border border-white/30 rounded-xl text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-yellow-300 focus:border-transparent transition-all duration-300 mobile-text" placeholder="Ex: Pagamento √† vista, desconto...">
                        <p class="text-xs text-white/60">M√°ximo 50 caracteres (opcional)</p>
                    </div>
                    <div class="space-y-2">
                        <label class="flex items-center space-x-3 text-sm font-semibold text-white cursor-pointer touch-target">
                            <input type="checkbox" id="hasInstallments" class="w-5 h-5 text-yellow-400 bg-white/20 border-white/30 rounded focus:ring-yellow-300 focus:ring-2">
                            <span class="mobile-text">üí≥ Parcela?</span>
                        </label>
                    </div>
                    <div class="space-y-2" id="installmentsField" style="display: none;">
                        <label class="block text-sm font-semibold text-white mobile-text">Quantas parcelas?</label>
                        <input type="text" id="installments" placeholder="Ex: 1/6 para 6 parcelas" class="w-full px-4 py-3 bg-white/20 backdrop-blur-sm border border-white/30 rounded-xl text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-yellow-300 focus:border-transparent transition-all duration-300 mobile-text">
                        <p class="text-xs text-white/60">Digite no formato 1/6 para criar 6 parcelas mensais</p>
                    </div>
                    <div class="sm:col-span-2 lg:col-span-4 flex justify-center mt-6">
                        <button type="submit" class="w-full sm:w-auto bg-gradient-to-r from-yellow-400 to-orange-500 text-gray-900 font-bold py-4 px-8 rounded-xl hover:from-yellow-300 hover:to-orange-400 transform hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-xl mobile-text mobile-button">
                            <i class="fas fa-plus mr-2"></i>Adicionar Transa√ß√£o
                        </button>
                    </div>
                </form>
            </div>

            <!-- Filters and Search -->
            <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-4 sm:p-6 mb-4 sm:mb-8 border border-white/20 mobile-card">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 sm:gap-6">
                    <div class="space-y-2 sm:col-span-2 lg:col-span-1">
                        <label class="block text-sm font-semibold text-gray-700 mobile-text">üîç Pesquisar</label>
                        <input type="text" id="searchInput" placeholder="Buscar transa√ß√µes..." class="w-full px-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300 hover:shadow-md mobile-text">
                    </div>
                    <div class="space-y-2">
                        <label class="block text-sm font-semibold text-gray-700 mobile-text">üìä Filtro</label>
                        <select id="filterType" class="w-full px-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300 hover:shadow-md mobile-text">
                            <option value="all">Todas</option>
                            <option value="income">Receitas</option>
                            <option value="expense">Despesas</option>
                            <option value="pending">Pendentes</option>
                            <option value="completed">Conclu√≠das</option>
                        </select>
                    </div>
                    <div class="space-y-2">
                        <label class="block text-sm font-semibold text-gray-700 mobile-text">üè∑Ô∏è Categoria</label>
                        <select id="filterCategory" class="w-full px-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300 hover:shadow-md mobile-text">
                            <option value="all">Todas</option>
                            <option value="alimentacao">üçΩÔ∏è Alimenta√ß√£o</option>
                            <option value="transporte">üöó Transporte</option>
                            <option value="moradia">üè† Moradia</option>
                            <option value="saude">üè• Sa√∫de</option>
                            <option value="educacao">üìö Educa√ß√£o</option>
                            <option value="lazer">üéÆ Lazer</option>
                            <option value="salario">üíº Sal√°rio</option>
                            <option value="freelance">üíª Freelance</option>
                            <option value="investimentos">üìà Investimentos</option>
                            <option value="outros">üì¶ Outros</option>
                        </select>
                    </div>
                    <div class="space-y-2">
                        <label class="block text-sm font-semibold text-gray-700 mobile-text">üìÖ M√™s/Ano</label>
                        <input type="month" id="filterMonth" class="w-full px-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300 hover:shadow-md mobile-text">
                    </div>
                    <div class="flex items-end sm:col-span-2 lg:col-span-1">
                        <button onclick="applyFilters()" class="w-full bg-gradient-to-r from-gray-600 to-gray-700 text-white font-semibold py-3 px-6 rounded-xl hover:from-gray-500 hover:to-gray-600 transform hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-xl mobile-text mobile-button">
                            <i class="fas fa-filter mr-2"></i>Filtrar
                        </button>
                    </div>
                </div>
            </div>

            <!-- Transactions List -->
            <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 overflow-hidden">
                <div class="bg-gradient-to-r from-indigo-600 to-purple-600 p-6">
                    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between space-y-4 sm:space-y-0">
                        <h3 class="text-xl font-bold text-white flex items-center">
                            <i class="fas fa-list-alt mr-3"></i>
                            Suas Transa√ß√µes
                        </h3>
                        <div class="flex items-center space-x-2">
                            <span class="text-white/80 text-sm font-medium mr-2">üìä Ordenar por:</span>
                            <button onclick="sortTransactions('date')" id="sortDateBtn" class="bg-white/20 hover:bg-white/30 text-white px-3 py-2 rounded-lg transition-all duration-200 text-sm font-medium border border-white/30 hover:border-white/50">
                                <i class="fas fa-calendar-alt mr-1"></i>Data
                            </button>
                            <button onclick="sortTransactions('amount')" id="sortAmountBtn" class="bg-white/20 hover:bg-white/30 text-white px-3 py-2 rounded-lg transition-all duration-200 text-sm font-medium border border-white/30 hover:border-white/50">
                                <i class="fas fa-dollar-sign mr-1"></i>Valor
                            </button>
                            <button onclick="toggleSortOrder()" id="sortOrderBtn" class="bg-white/20 hover:bg-white/30 text-white px-2 py-2 rounded-lg transition-all duration-200 text-sm font-medium border border-white/30 hover:border-white/50" title="Alterar ordem">
                                <i class="fas fa-sort-amount-down"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div id="transactionsList" class="divide-y divide-gray-100">
                    <!-- Transactions will be populated here -->
                </div>
            </div>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content hidden fade-in">
            <!-- Dashboard Filters -->
            <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-6 mb-8 border border-white/20">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="space-y-2">
                        <label class="block text-sm font-semibold text-gray-700">üìÖ Filtrar por M√™s/Ano</label>
                        <input type="month" id="dashboardFilterMonth" class="w-full px-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300 hover:shadow-md">
                    </div>
                    <div class="space-y-2">
                        <label class="block text-sm font-semibold text-gray-700">üìä Tipo de Transa√ß√£o</label>
                        <select id="dashboardFilterType" class="w-full px-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300 hover:shadow-md">
                            <option value="all">Todas</option>
                            <option value="completed">Apenas Conclu√≠das</option>
                            <option value="pending">Apenas Pendentes</option>
                        </select>
                    </div>
                    <div class="flex items-end">
                        <button onclick="applyDashboardFilters()" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold py-3 px-6 rounded-xl hover:from-indigo-500 hover:to-purple-500 transform hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-xl">
                            <i class="fas fa-filter mr-2"></i>Aplicar Filtros
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Summary Cards -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-8 mb-4 sm:mb-8">
                <div onclick="showIncomeDetails()" class="bg-gradient-to-br from-green-400 to-green-600 rounded-2xl shadow-xl p-4 sm:p-8 text-white transform hover:scale-105 transition-all duration-300 hover:shadow-2xl cursor-pointer">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-100 text-xs sm:text-sm font-medium">Total Receitas</p>
                            <p id="totalIncome2" class="text-xl sm:text-3xl font-bold mt-1 sm:mt-2">R$ 0,00</p>
                        </div>
                        <div class="bg-white/20 p-2 sm:p-4 rounded-full">
                            <i class="fas fa-arrow-trend-up text-lg sm:text-2xl"></i>
                        </div>
                    </div>
                    <div class="mt-2 sm:mt-4 flex items-center">
                        <i class="fas fa-chart-line mr-2 text-green-200 text-sm"></i>
                        <span class="text-green-100 text-xs sm:text-sm">Entradas do m√™s</span>
                    </div>
                </div>
                
                <div onclick="showExpenseDetails()" class="bg-gradient-to-br from-red-400 to-red-600 rounded-2xl shadow-xl p-4 sm:p-8 text-white transform hover:scale-105 transition-all duration-300 hover:shadow-2xl cursor-pointer">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-red-100 text-xs sm:text-sm font-medium">Total Despesas</p>
                            <p id="totalExpenses2" class="text-xl sm:text-3xl font-bold mt-1 sm:mt-2">R$ 0,00</p>
                        </div>
                        <div class="bg-white/20 p-2 sm:p-4 rounded-full">
                            <i class="fas fa-arrow-trend-down text-lg sm:text-2xl"></i>
                        </div>
                    </div>
                    <div class="mt-2 sm:mt-4 flex items-center">
                        <i class="fas fa-chart-line-down mr-2 text-red-200 text-sm"></i>
                        <span class="text-red-100 text-xs sm:text-sm">Sa√≠das do m√™s</span>
                    </div>
                </div>
                
                <div onclick="showPendingDetails()" class="bg-gradient-to-br from-blue-400 to-blue-600 rounded-2xl shadow-xl p-4 sm:p-8 text-white transform hover:scale-105 transition-all duration-300 hover:shadow-2xl sm:col-span-2 lg:col-span-1 cursor-pointer">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-100 text-xs sm:text-sm font-medium">Contas Pendentes</p>
                            <p id="pendingCount2" class="text-xl sm:text-3xl font-bold mt-1 sm:mt-2">0</p>
                        </div>
                        <div class="bg-white/20 p-2 sm:p-4 rounded-full">
                            <i class="fas fa-clock text-lg sm:text-2xl"></i>
                        </div>
                    </div>
                    <div class="mt-2 sm:mt-4 flex items-center">
                        <i class="fas fa-exclamation-triangle mr-2 text-blue-200 text-sm"></i>
                        <span class="text-blue-100 text-xs sm:text-sm">Aguardando pagamento</span>
                    </div>
                </div>
            </div>

            <!-- Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-8">
                <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-4 sm:p-8 border border-white/20 transform hover:scale-105 transition-all duration-300">
                    <h3 class="text-lg sm:text-xl font-bold text-gray-800 mb-4 sm:mb-6 flex items-center">
                        <i class="fas fa-chart-pie mr-2 sm:mr-3 text-indigo-600"></i>
                        <span class="hidden sm:inline">Despesas por </span><span class="sm:hidden">Despesas por </span>Categoria
                    </h3>
                    <div class="h-64 sm:h-auto">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>
                <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-4 sm:p-8 border border-white/20 transform hover:scale-105 transition-all duration-300">
                    <h3 class="text-lg sm:text-xl font-bold text-gray-800 mb-4 sm:mb-6 flex items-center">
                        <i class="fas fa-chart-line mr-2 sm:mr-3 text-purple-600"></i>
                        <span class="hidden sm:inline">Evolu√ß√£o </span><span class="sm:hidden">Evolu√ß√£o </span>Financeira
                    </h3>
                    <div class="h-64 sm:h-auto">
                        <canvas id="monthlyChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Calendar Tab -->
        <div id="calendar" class="tab-content hidden fade-in">
            <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-4 sm:p-8 border border-white/20">
                <div class="flex flex-col sm:flex-row items-center justify-between mb-4 sm:mb-8 space-y-4 sm:space-y-0">
                    <h3 class="text-lg sm:text-2xl font-bold text-gray-800 flex items-center mobile-text">
                        <i class="fas fa-calendar-alt mr-2 sm:mr-3 text-indigo-600"></i>
                        <span class="hidden sm:inline">Calend√°rio </span>Financeiro
                    </h3>
                    <div class="flex items-center space-x-2 sm:space-x-4">
                        <button onclick="previousMonth()" class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white p-3 sm:p-4 rounded-xl transition-all duration-300 shadow-lg touch-target mobile-button">
                            <i class="fas fa-chevron-left text-base sm:text-lg"></i>
                        </button>
                        <span id="currentMonth" class="text-sm sm:text-xl font-bold text-gray-800 min-w-32 sm:min-w-48 text-center mobile-text px-2"></span>
                        <button onclick="nextMonth()" class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white p-3 sm:p-4 rounded-xl transition-all duration-300 shadow-lg touch-target mobile-button">
                            <i class="fas fa-chevron-right text-base sm:text-lg"></i>
                        </button>
                    </div>
                </div>
                <div class="mb-4 sm:mb-6 flex items-center justify-center space-x-4 sm:space-x-8 text-xs sm:text-sm bg-gradient-to-r from-gray-50 to-gray-100 p-3 sm:p-4 rounded-xl">
                    <div class="flex items-center">
                        <div class="w-3 h-3 sm:w-4 sm:h-4 bg-red-500 rounded-full mr-2 sm:mr-3 shadow-md"></div>
                        <span class="font-semibold text-gray-700"><span class="hidden sm:inline">üí∏ </span>Despesas</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-3 h-3 sm:w-4 sm:h-4 bg-green-500 rounded-full mr-2 sm:mr-3 shadow-md"></div>
                        <span class="font-semibold text-gray-700"><span class="hidden sm:inline">üí∞ </span>Receitas</span>
                    </div>
                </div>
                <div id="calendarGrid" class="grid grid-cols-7 gap-1 sm:gap-2 bg-gradient-to-br from-gray-50 to-white p-2 sm:p-4 rounded-xl shadow-inner">
                    <!-- Calendar will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- MySchedule Button -->
    <div class="container mx-auto px-4 py-6 text-center">
        <a href="https://necleg.github.io/MySchedule/" target="_blank" class="inline-flex items-center bg-gradient-to-r from-emerald-500 via-teal-500 to-cyan-500 hover:from-emerald-400 hover:via-teal-400 hover:to-cyan-400 text-white font-bold py-3 px-6 rounded-2xl shadow-2xl hover:shadow-3xl transform hover:scale-105 transition-all duration-300 border border-white/20 backdrop-blur-sm">
            <div class="bg-white/20 p-2 rounded-full mr-3">
                <i class="fas fa-calendar-alt text-3xl sm:text-4xl lg:text-5xl text-white drop-shadow-lg hover:scale-110 transition-transform duration-300"></i>
            </div>
            <div class="text-xl sm:text-2xl lg:text-3xl font-bold">MySchedule</div>
            <i class="fas fa-external-link-alt ml-3 text-white/70"></i>
        </a>
    </div>

    <!-- Footer -->
    <footer class="bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 py-6">
        <div class="container mx-auto px-4 text-center">
            <div class="text-white/80 text-sm">
                <p class="mb-2">¬© 2025 FinanceWay - Todos os direitos reservados</p>
                <p class="text-xs text-white/60">Desenvolvido por <span class="font-semibold text-yellow-300">Gabriel</span></p>
            </div>
        </div>
    </footer>

    <!-- Details Modal -->
    <div id="detailsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl p-4 sm:p-8 w-full max-w-4xl max-h-[90vh] overflow-y-auto shadow-2xl mobile-modal">
            <div class="flex items-center justify-between mb-4 sm:mb-6">
                <h3 id="detailsModalTitle" class="text-lg sm:text-2xl font-bold text-gray-800 mobile-text"></h3>
                <button onclick="closeDetailsModal()" class="text-gray-400 hover:text-gray-600 p-3 rounded-full hover:bg-gray-100 transition-all duration-300 touch-target">
                    <i class="fas fa-times text-lg sm:text-xl"></i>
                </button>
            </div>
            <div id="detailsContent" class="space-y-4">
                <!-- Details content will be populated here -->
            </div>
        </div>
    </div>

    <!-- Day Transactions Modal -->
    <div id="dayModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl p-4 sm:p-8 w-full max-w-3xl max-h-[90vh] overflow-y-auto shadow-2xl">
            <div class="flex items-center justify-between mb-4 sm:mb-6">
                <h3 id="dayModalTitle" class="text-lg sm:text-2xl font-bold text-gray-800"></h3>
                <button onclick="closeDayModal()" class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100 transition-all duration-300">
                    <i class="fas fa-times text-lg sm:text-xl"></i>
                </button>
            </div>
            <div id="dayTransactions" class="space-y-3 sm:space-y-4">
                <!-- Day transactions will be populated here -->
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl p-4 sm:p-8 w-full max-w-md shadow-2xl max-h-[90vh] overflow-y-auto">
            <h3 class="text-lg sm:text-2xl font-bold text-gray-800 mb-4 sm:mb-6">Editar Transa√ß√£o</h3>
            <form id="editForm">
                <input type="hidden" id="editId">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Descri√ß√£o</label>
                    <input type="text" id="editDescription" class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all duration-300 text-sm sm:text-base">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Valor</label>
                    <input type="number" id="editAmount" step="0.01" class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all duration-300 text-sm sm:text-base">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Categoria</label>
                    <select id="editCategory" class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all duration-300 text-sm sm:text-base">
                        <option value="alimentacao">Alimenta√ß√£o</option>
                        <option value="transporte">Transporte</option>
                        <option value="moradia">Moradia</option>
                        <option value="saude">Sa√∫de</option>
                        <option value="educacao">Educa√ß√£o</option>
                        <option value="lazer">Lazer</option>
                        <option value="salario">Sal√°rio</option>
                        <option value="freelance">Freelance</option>
                        <option value="investimentos">Investimentos</option>
                        <option value="outros">Outros</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Data</label>
                    <input type="date" id="editDate" class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all duration-300 text-sm sm:text-base">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Prioridade</label>
                    <select id="editPriority" class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all duration-300 text-sm sm:text-base">
                        <option value="baixa">Baixa</option>
                        <option value="media">M√©dia</option>
                        <option value="alta">Alta</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Observa√ß√µes</label>
                    <input type="text" id="editObservations" maxlength="50" class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all duration-300 text-sm sm:text-base" placeholder="Ex: Pagamento √† vista, desconto...">
                    <p class="text-xs text-gray-500 mt-1">M√°ximo 50 caracteres</p>
                </div>
                <div class="mb-6" id="editInstallmentsField" style="display: none;">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Parcelas</label>
                    <input type="text" id="editInstallments" placeholder="Ex: 2/6" class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all duration-300 text-sm sm:text-base" readonly>
                    <p class="text-xs text-gray-500 mt-1">Parcelas n√£o podem ser editadas ap√≥s cria√ß√£o</p>
                </div>
                <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4">
                    <button type="button" onclick="closeEditModal()" class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 sm:py-3 sm:px-6 rounded-xl hover:bg-gray-400 transition-all duration-300 font-semibold text-sm sm:text-base">
                        Cancelar
                    </button>
                    <button type="submit" class="flex-1 bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-2 px-4 sm:py-3 sm:px-6 rounded-xl hover:from-indigo-500 hover:to-purple-500 transition-all duration-300 font-semibold text-sm sm:text-base">
                        Salvar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Data storage
        let transactions = [];
        let currentDate = new Date();
        let categoryChart, monthlyChart;
        let unsubscribeTransactions = null;
        let currentSortBy = 'date';
        let sortOrder = 'desc'; // 'asc' or 'desc'
        
        // Tab management
        let currentTabIndex = 0;
        const tabs = ['transactions', 'dashboard', 'calendar'];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeAuth();
            document.getElementById('date').valueAsDate = new Date();
            
            // Set default dashboard filter to current month
            const currentMonth = new Date().toISOString().substring(0, 7);
            document.getElementById('dashboardFilterMonth').value = currentMonth;
            
            // Set default balance month to current month
            document.getElementById('balanceMonth').value = currentMonth;
            document.getElementById('balanceMonthMobile').value = currentMonth;
            
            initCharts();
            updateSortButtons();
            updateSortOrderButton();
            
            // Show/hide installments field based on checkbox
            document.getElementById('hasInstallments').addEventListener('change', function() {
                const installmentsField = document.getElementById('installmentsField');
                if (this.checked) {
                    installmentsField.style.display = 'block';
                } else {
                    installmentsField.style.display = 'none';
                    document.getElementById('installments').value = '';
                }
            });
        });

        // Firebase Authentication
        function initializeAuth() {
            if (window.auth && window.onAuthStateChanged) {
                window.onAuthStateChanged(window.auth, (user) => {
                    if (user) {
                        window.currentUser = user;
                        document.getElementById('loginModal').classList.add('hidden');
                        
                        // Remove blur effect
                        document.getElementById('mainHeader').classList.remove('blur-sm', 'pointer-events-none');
                        document.getElementById('mainContent').classList.remove('blur-sm', 'pointer-events-none');
                        
                        // Show user info for both desktop and mobile
                        const userInfo = document.getElementById('userInfo');
                        const userInfoMobile = document.getElementById('userInfoMobile');
                        const userEmail = document.getElementById('userEmail');
                        
                        if (userInfo) userInfo.classList.remove('hidden');
                        if (userInfoMobile) userInfoMobile.classList.remove('hidden');
                        if (userEmail) userEmail.textContent = user.email || user.displayName;
                        
                        setupRealtimeListener();
                    } else {
                        window.currentUser = null;
                        document.getElementById('loginModal').classList.remove('hidden');
                        
                        // Add blur effect to background
                        document.getElementById('mainHeader').classList.add('blur-sm', 'pointer-events-none');
                        document.getElementById('mainContent').classList.add('blur-sm', 'pointer-events-none');
                        
                        // Hide user info for both desktop and mobile
                        const userInfo = document.getElementById('userInfo');
                        const userInfoMobile = document.getElementById('userInfoMobile');
                        
                        if (userInfo) userInfo.classList.add('hidden');
                        if (userInfoMobile) userInfoMobile.classList.add('hidden');
                        
                        if (unsubscribeTransactions) {
                            unsubscribeTransactions();
                            unsubscribeTransactions = null;
                        }
                        transactions = [];
                        updateDashboard();
                        renderTransactions();
                        renderCalendar();
                        renderReminders();
                        updateCharts();
                    }
                });
            }
        }

        // Login functions
        function showLoginForm() {
            document.getElementById('loginBtn').classList.add('hidden');
            document.getElementById('registerBtn').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
        }

        function hideLoginForm() {
            document.getElementById('loginBtn').classList.remove('hidden');
            document.getElementById('registerBtn').classList.remove('hidden');
            document.getElementById('loginForm').classList.add('hidden');
        }

        function showRegisterForm() {
            document.getElementById('loginBtn').classList.add('hidden');
            document.getElementById('registerBtn').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
        }

        function hideRegisterForm() {
            document.getElementById('loginBtn').classList.remove('hidden');
            document.getElementById('registerBtn').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('hidden');
        }

        // Google Sign In
        async function signInWithGoogle() {
            try {
                const result = await window.signInWithPopup(window.auth, window.googleProvider);
                // User is signed in automatically by onAuthStateChanged
            } catch (error) {
                console.error('Erro no login com Google:', error);
                alert('Erro ao fazer login com Google: ' + error.message);
            }
        }

        // Login form handler
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                await window.signInWithEmailAndPassword(window.auth, email, password);
            } catch (error) {
                alert('Erro ao fazer login: ' + error.message);
            }
        });

        // Register form handler
        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            
            try {
                await window.createUserWithEmailAndPassword(window.auth, email, password);
            } catch (error) {
                alert('Erro ao criar conta: ' + error.message);
            }
        });



        // Logout function
        async function logout() {
            try {
                await window.signOut(window.auth);
                showSuccessMessage('Logout realizado com sucesso!');
            } catch (error) {
                alert('Erro ao sair: ' + error.message);
            }
        }

        // Firebase data functions with real-time sync
        function setupRealtimeListener() {
            if (!window.currentUser || !window.db) return;
            
            try {
                const eventsRef = window.collection(window.db, 'users', window.currentUser.uid, 'events');
                const q = window.query(eventsRef, window.orderBy('date', 'desc'));
                
                unsubscribeTransactions = window.onSnapshot(q, (snapshot) => {
                    transactions = [];
                    snapshot.forEach((doc) => {
                        const data = doc.data();
                        transactions.push({
                            id: doc.id,
                            ...data
                        });
                    });
                    
                    updateDashboard();
                    renderTransactions();
                    renderCalendar();
                    renderReminders();
                    updateCharts();
                }, (error) => {
                    console.error('Erro ao escutar mudan√ßas:', error);
                });
            } catch (error) {
                console.error('Erro ao configurar listener:', error);
            }
        }

        async function saveTransactionToFirebase(transaction) {
            if (!window.currentUser || !window.db) return;
            
            try {
                const eventsRef = window.collection(window.db, 'users', window.currentUser.uid, 'events');
                
                if (transaction.id && typeof transaction.id === 'string') {
                    // Update existing transaction
                    const docRef = window.doc(window.db, 'users', window.currentUser.uid, 'events', transaction.id);
                    await window.setDoc(docRef, transaction);
                } else {
                    // Add new transaction
                    const docRef = await window.addDoc(eventsRef, transaction);
                    transaction.id = docRef.id;
                }
            } catch (error) {
                console.error('Erro ao salvar transa√ß√£o:', error);
                alert('Erro ao salvar transa√ß√£o. Tente novamente.');
            }
        }

        async function deleteTransactionFromFirebase(transactionId) {
            if (!window.currentUser || !window.db) return;
            
            try {
                const docRef = window.doc(window.db, 'users', window.currentUser.uid, 'events', transactionId);
                await window.deleteDoc(docRef);
            } catch (error) {
                console.error('Erro ao excluir transa√ß√£o:', error);
                alert('Erro ao excluir transa√ß√£o. Tente novamente.');
            }
        }



        // Tab functionality
        function showTab(tabName, tabIndex = null) {
            // Update current tab index if provided
            if (tabIndex !== null) {
                currentTabIndex = tabIndex;
            } else {
                // Find the tab index
                currentTabIndex = tabs.indexOf(tabName);
            }
            
            // Hide all tabs with fade out
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
                tab.style.opacity = '0';
            });
            
            // Reset all tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('bg-gradient-to-r', 'from-indigo-500', 'to-purple-600', 'shadow-lg', 'text-white', 'font-bold', 'hover:shadow-xl');
                btn.classList.add('text-white/70', 'font-semibold', 'hover:text-white', 'hover:bg-white/20', 'transform', 'hover:scale-105', 'hover:shadow-lg');
            });
            
            // Show selected tab with fade in
            const selectedTab = document.getElementById(tabName);
            selectedTab.classList.remove('hidden');
            
            // Trigger reflow and fade in
            setTimeout(() => {
                selectedTab.style.opacity = '1';
            }, 50);
            
            // Style active tab button - find the correct button
            const tabButtons = document.querySelectorAll('.tab-btn');
            const activeButton = tabButtons[currentTabIndex];
            if (activeButton) {
                activeButton.classList.remove('text-white/70', 'font-semibold', 'hover:text-white', 'hover:bg-white/20', 'hover:shadow-lg');
                activeButton.classList.add('bg-gradient-to-r', 'from-indigo-500', 'to-purple-600', 'shadow-lg', 'text-white', 'font-bold', 'hover:shadow-xl');
            }
        }

        // Transaction form
        document.getElementById('transactionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Add loading state
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Salvando...';
            submitBtn.disabled = true;
            this.classList.add('loading');
            
            try {
                const hasInstallments = document.getElementById('hasInstallments').checked;
                const installmentsValue = document.getElementById('installments').value.trim();
                const type = document.getElementById('type').value;
                
                // Check if installments checkbox is checked and has valid format
                if (hasInstallments && installmentsValue && installmentsValue.includes('/')) {
                    const [currentInstallment, totalInstallments] = installmentsValue.split('/').map(n => parseInt(n));
                    
                    if (currentInstallment > 0 && totalInstallments > 0 && currentInstallment <= totalInstallments) {
                        // Create installments
                        const baseDate = new Date(document.getElementById('date').value);
                        const baseTransaction = {
                            description: document.getElementById('description').value,
                            amount: parseFloat(document.getElementById('amount').value),
                            type: type,
                            category: document.getElementById('category').value,
                            priority: document.getElementById('priority').value,
                            observations: document.getElementById('observations').value.trim() || null,
                            completed: false,
                            createdAt: new Date().toISOString(),
                            isInstallment: true,
                            totalInstallments: totalInstallments
                        };
                        
                        // Create all installments
                        for (let i = 0; i < totalInstallments; i++) {
                            const installmentDate = new Date(baseDate);
                            installmentDate.setMonth(installmentDate.getMonth() + i);
                            
                            const installmentTransaction = {
                                ...baseTransaction,
                                date: installmentDate.toISOString().split('T')[0],
                                description: `${baseTransaction.description} (${i + 1}/${totalInstallments})`,
                                installmentNumber: i + 1
                            };
                            
                            await saveTransactionToFirebase(installmentTransaction);
                        }
                        
                        showSuccessMessage(`${totalInstallments} parcelas criadas com sucesso!`);
                    } else {
                        alert('Formato de parcela inv√°lido. Use o formato 1/6 por exemplo.');
                        return;
                    }
                } else {
                    // Regular transaction
                    const transaction = {
                        description: document.getElementById('description').value,
                        amount: parseFloat(document.getElementById('amount').value),
                        type: type,
                        category: document.getElementById('category').value,
                        date: document.getElementById('date').value,
                        priority: document.getElementById('priority').value,
                        observations: document.getElementById('observations').value.trim() || null,
                        completed: false,
                        createdAt: new Date().toISOString()
                    };

                    await saveTransactionToFirebase(transaction);
                    showSuccessMessage('Transa√ß√£o adicionada com sucesso!');
                }
                
                this.reset();
                document.getElementById('date').valueAsDate = new Date();
                document.getElementById('installmentsField').style.display = 'none';
                document.getElementById('hasInstallments').checked = false;
            } catch (error) {
                console.error('Erro ao salvar transa√ß√£o:', error);
                alert('Erro ao salvar transa√ß√£o. Tente novamente.');
            } finally {
                // Remove loading state
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
                this.classList.remove('loading');
            }
        });

        // Edit form
        document.getElementById('editForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const id = document.getElementById('editId').value;
            const transaction = transactions.find(t => t.id === id);
            
            if (transaction) {
                transaction.description = document.getElementById('editDescription').value;
                transaction.amount = parseFloat(document.getElementById('editAmount').value);
                transaction.category = document.getElementById('editCategory').value;
                transaction.date = document.getElementById('editDate').value;
                transaction.priority = document.getElementById('editPriority').value;
                transaction.observations = document.getElementById('editObservations').value.trim() || null;
                transaction.updatedAt = new Date().toISOString();
                
                await saveTransactionToFirebase(transaction);
                closeEditModal();
                showSuccessMessage('Transa√ß√£o atualizada com sucesso!');
            }
        });

        // Success message helper
        function showSuccessMessage(message) {
            const successMsg = document.createElement('div');
            
            // Check if mobile
            const isMobile = window.innerWidth <= 768;
            
            if (isMobile) {
                successMsg.className = 'fixed success-mobile bg-green-500 text-white px-6 py-4 rounded-xl shadow-2xl z-50 fade-in success-pulse mobile-text text-center cursor-pointer';
            } else {
                successMsg.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-500 text-white px-6 py-4 rounded-xl shadow-2xl z-50 fade-in success-pulse mobile-text max-w-sm mx-4 text-center cursor-pointer';
            }
            
            successMsg.innerHTML = `<i class="fas fa-check mr-2"></i>${message}`;
            document.body.appendChild(successMsg);
            
            // Add touch to dismiss
            successMsg.addEventListener('click', () => {
                successMsg.style.opacity = '0';
                successMsg.style.transform = isMobile ? 'translateY(20px) scale(0.9)' : 'translate(-50%, -20px) scale(0.9)';
                setTimeout(() => {
                    if (successMsg.parentNode) {
                        successMsg.remove();
                    }
                }, 300);
            });
            
            // Auto dismiss
            setTimeout(() => {
                if (successMsg.parentNode) {
                    successMsg.style.opacity = '0';
                    successMsg.style.transform = isMobile ? 'translateY(20px) scale(0.9)' : 'translate(-50%, -20px) scale(0.9)';
                    setTimeout(() => {
                        if (successMsg.parentNode) {
                            successMsg.remove();
                        }
                    }, 300);
                }
            }, 3000);
        }



        // Render reminders
        function renderReminders() {
            const today = new Date();
            const oneWeekFromNow = new Date();
            oneWeekFromNow.setDate(today.getDate() + 7);
            
            const todayStr = today.toISOString().split('T')[0];
            const oneWeekStr = oneWeekFromNow.toISOString().split('T')[0];
            
            // Due today - only pending expenses
            const dueToday = transactions.filter(t => 
                !t.completed && t.date === todayStr && t.type === 'expense'
            );
            
            // Due within a week - only pending expenses
            const dueThisWeek = transactions.filter(t => 
                !t.completed && t.date > todayStr && t.date <= oneWeekStr && t.type === 'expense'
            );
            
            const remindersContainer = document.getElementById('reminders');
            
            if (dueToday.length === 0 && dueThisWeek.length === 0) {
                remindersContainer.innerHTML = '';
                return;
            }
            
            let remindersHTML = '';
            
            if (dueToday.length > 0) {
                remindersHTML += `
                    <div class="bg-gradient-to-r from-red-50 to-red-100 border-l-4 border-red-500 p-6 mb-6 rounded-r-2xl shadow-lg">
                        <div class="flex items-center mb-4">
                            <i class="fas fa-exclamation-triangle text-red-600 mr-3 text-xl"></i>
                            <h4 class="font-bold text-red-800 text-lg">üö® Contas Vencendo Hoje</h4>
                        </div>
                        <div class="space-y-3">
                            ${dueToday.map(t => `
                                <div class="flex items-center justify-between bg-white p-4 rounded-xl shadow-sm hover:shadow-md transition-all duration-300">
                                    <div class="flex items-center flex-1">
                                        <span class="w-3 h-3 rounded-full ${getPriorityColor(t.priority)} mr-3 shadow-sm"></span>
                                        <div class="flex-1">
                                            <div class="flex items-center">
                                                <span class="font-semibold text-gray-800">${t.description}</span>
                                                <span class="text-sm text-gray-600 ml-3 bg-gray-100 px-2 py-1 rounded-full">${formatCurrency(t.amount)}</span>
                                            </div>
                                            ${t.observations ? `<p class="text-xs text-gray-500 mt-1 italic">üí¨ ${t.observations}</p>` : ''}
                                        </div>
                                    </div>
                                    <button onclick="toggleComplete('${t.id}')" class="bg-green-500 hover:bg-green-600 text-white p-2 rounded-full transition-all duration-300 transform hover:scale-110 ml-3">
                                        <i class="fas fa-check"></i>
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            if (dueThisWeek.length > 0) {
                remindersHTML += `
                    <div class="bg-gradient-to-r from-yellow-50 to-yellow-100 border-l-4 border-yellow-500 p-6 mb-6 rounded-r-2xl shadow-lg">
                        <div class="flex items-center mb-4">
                            <i class="fas fa-clock text-yellow-600 mr-3 text-xl"></i>
                            <h4 class="font-bold text-yellow-800 text-lg">‚è∞ Pr√≥ximas Contas (7 dias)</h4>
                        </div>
                        <div class="space-y-3">
                            ${dueThisWeek.map(t => `
                                <div class="flex items-center justify-between bg-white p-4 rounded-xl shadow-sm hover:shadow-md transition-all duration-300">
                                    <div class="flex items-center flex-1">
                                        <span class="w-3 h-3 rounded-full ${getPriorityColor(t.priority)} mr-3 shadow-sm"></span>
                                        <div class="flex-1">
                                            <div class="flex items-center">
                                                <span class="font-semibold text-gray-800">${t.description}</span>
                                                <span class="text-sm text-gray-600 ml-3 bg-gray-100 px-2 py-1 rounded-full">${formatCurrency(t.amount)} - ${formatDate(t.date)}</span>
                                            </div>
                                            ${t.observations ? `<p class="text-xs text-gray-500 mt-1 italic">üí¨ ${t.observations}</p>` : ''}
                                        </div>
                                    </div>
                                    <button onclick="toggleComplete('${t.id}')" class="bg-green-500 hover:bg-green-600 text-white p-2 rounded-full transition-all duration-300 transform hover:scale-110 ml-3">
                                        <i class="fas fa-check"></i>
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            remindersContainer.innerHTML = remindersHTML;
        }

        // Update dashboard
        function updateDashboard() {
            updateBalanceDisplay();
            updateDashboardCards();
        }

        // Update balance display based on selected month
        function updateBalanceDisplay() {
            // Get selected month from both desktop and mobile inputs
            const balanceMonth = document.getElementById('balanceMonth').value || new Date().toISOString().substring(0, 7);
            const balanceMonthMobile = document.getElementById('balanceMonthMobile').value || new Date().toISOString().substring(0, 7);
            
            // Sync both inputs
            document.getElementById('balanceMonth').value = balanceMonth;
            document.getElementById('balanceMonthMobile').value = balanceMonth;
            
            // Update month label - fix the date parsing
            const [year, month] = balanceMonth.split('-');
            const selectedDate = new Date(parseInt(year), parseInt(month) - 1, 1);
            const monthName = selectedDate.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
            const currentMonthLabel = document.getElementById('currentMonthLabel');
            const currentMonthLabelMobile = document.getElementById('currentMonthLabelMobile');
            
            if (currentMonthLabel) currentMonthLabel.textContent = monthName;
            if (currentMonthLabelMobile) currentMonthLabelMobile.textContent = monthName;
            
            // Filter transactions for selected month
            const selectedMonthTransactions = transactions.filter(t => t.date.startsWith(balanceMonth));
            const selectedMonthIncome = selectedMonthTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const selectedMonthExpenses = selectedMonthTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const selectedMonthBalance = selectedMonthIncome - selectedMonthExpenses;

            // Update both desktop and mobile balance displays
            const balanceElement = document.getElementById('currentBalance');
            const balanceElementMobile = document.getElementById('currentBalanceMobile');
            
            if (balanceElement) {
                balanceElement.textContent = formatCurrency(selectedMonthBalance);
                balanceElement.className = selectedMonthBalance >= 0 ? 'text-3xl font-bold text-white' : 'text-3xl font-bold text-red-300';
            }
            
            if (balanceElementMobile) {
                balanceElementMobile.textContent = formatCurrency(selectedMonthBalance);
                balanceElementMobile.className = selectedMonthBalance >= 0 ? 'text-2xl font-bold text-white' : 'text-2xl font-bold text-red-300';
            }
        }

        // Update dashboard cards with filters
        function updateDashboardCards() {
            const filteredTransactions = getDashboardFilteredTransactions();
            
            const totalIncome = filteredTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const totalExpenses = filteredTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const pendingCount = filteredTransactions.filter(t => !t.completed && t.type === 'expense').length;
            
            // Update dashboard cards if they exist
            const totalIncome2 = document.getElementById('totalIncome2');
            const totalExpenses2 = document.getElementById('totalExpenses2');
            const pendingCount2 = document.getElementById('pendingCount2');
            
            if (totalIncome2) totalIncome2.textContent = formatCurrency(totalIncome);
            if (totalExpenses2) totalExpenses2.textContent = formatCurrency(totalExpenses);
            if (pendingCount2) pendingCount2.textContent = pendingCount;
        }

        // Get filtered transactions for dashboard
        function getDashboardFilteredTransactions() {
            let filtered = [...transactions];
            
            const filterMonth = document.getElementById('dashboardFilterMonth').value;
            const filterType = document.getElementById('dashboardFilterType').value;

            if (filterMonth) {
                filtered = filtered.filter(t => t.date.startsWith(filterMonth));
            } else {
                // Default to current month if no filter is set
                const currentMonth = new Date().toISOString().substring(0, 7);
                filtered = filtered.filter(t => t.date.startsWith(currentMonth));
            }

            if (filterType !== 'all') {
                if (filterType === 'completed') {
                    filtered = filtered.filter(t => t.completed);
                } else if (filterType === 'pending') {
                    filtered = filtered.filter(t => !t.completed);
                }
            }

            return filtered;
        }

        // Apply dashboard filters
        function applyDashboardFilters() {
            updateDashboardCards();
            updateDashboardCharts();
            showSuccessMessage('Filtros aplicados no dashboard!');
        }

        // Priority helper functions
        function getPriorityColor(priority) {
            switch(priority) {
                case 'alta': return 'bg-red-500';
                case 'media': return 'bg-yellow-500';
                case 'baixa': return 'bg-green-500';
                default: return 'bg-gray-500';
            }
        }

        function getPriorityName(priority) {
            switch(priority) {
                case 'alta': return 'Alta';
                case 'media': return 'M√©dia';
                case 'baixa': return 'Baixa';
                default: return 'Baixa';
            }
        }

        // Render transactions
        function renderTransactions() {
            const container = document.getElementById('transactionsList');
            const filteredTransactions = getFilteredTransactions();
            
            if (filteredTransactions.length === 0) {
                container.innerHTML = '<div class="p-8 text-center text-gray-500 text-lg">Nenhuma transa√ß√£o encontrada üì≠</div>';
                return;
            }

            container.innerHTML = filteredTransactions.map(transaction => `
                <div class="p-4 sm:p-6 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 fade-in hover-lift border-l-4 ${transaction.type === 'income' ? 'border-green-500' : 'border-red-500'} ${transaction.completed ? 'completed-transaction' : ''}">
                    <!-- Mobile Layout -->
                    <div class="block sm:hidden">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 rounded-full flex items-center justify-center ${transaction.type === 'income' ? 'bg-gradient-to-r from-green-400 to-green-600' : 'bg-gradient-to-r from-red-400 to-red-600'} shadow-lg ${transaction.completed ? 'opacity-60' : ''}">
                                    <i class="fas ${transaction.type === 'income' ? 'fa-arrow-up' : 'fa-arrow-down'} text-white text-sm"></i>
                                </div>
                                <div class="flex-1">
                                    <div class="flex items-center">
                                        <h4 class="font-bold text-gray-800 text-base ${transaction.completed ? 'line-through' : ''}">${transaction.description}</h4>
                                        <span class="w-2 h-2 rounded-full ${getPriorityColor(transaction.priority)} ml-2 shadow-sm"></span>
                                        ${transaction.completed ? '<i class="fas fa-check-circle text-green-500 ml-1 text-sm"></i>' : ''}
                                    </div>
                                </div>
                            </div>
                            <span class="font-bold text-lg ${transaction.type === 'income' ? 'text-green-600' : 'text-red-600'} ${transaction.completed ? 'line-through opacity-60' : ''}">
                                ${transaction.type === 'income' ? '+' : '-'}${formatCurrency(transaction.amount)}
                            </span>
                        </div>
                        <div class="mb-3">
                            <p class="text-xs text-gray-600">
                                <span class="bg-gray-100 px-2 py-1 rounded-full text-xs font-medium mr-2">${getCategoryName(transaction.category)}</span>
                                üìÖ ${formatDate(transaction.date)} ‚Ä¢ 
                                <span class="font-medium">${getPriorityName(transaction.priority)}</span>
                                ${transaction.completed ? ' ‚Ä¢ ‚úÖ Conclu√≠da' : ' ‚Ä¢ ‚è≥ Pendente'}
                            </p>
                        </div>
                        <div class="flex justify-end space-x-2">
                            <button onclick="toggleComplete('${transaction.id}')" class="p-3 rounded-full hover:bg-green-100 ${transaction.completed ? 'text-green-600 bg-green-50' : 'text-gray-400 hover:text-green-600'} transition-all duration-300 touch-target">
                                <i class="fas fa-check text-base"></i>
                            </button>
                            <button onclick="editTransaction('${transaction.id}')" class="p-3 rounded-full hover:bg-blue-100 text-blue-600 transition-all duration-300 touch-target">
                                <i class="fas fa-edit text-base"></i>
                            </button>
                            <button onclick="deleteTransaction('${transaction.id}')" class="p-3 rounded-full hover:bg-red-100 text-red-600 transition-all duration-300 touch-target">
                                <i class="fas fa-trash text-base"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Desktop Layout -->
                    <div class="hidden sm:flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <div class="flex-shrink-0">
                                <div class="w-14 h-14 rounded-full flex items-center justify-center ${transaction.type === 'income' ? 'bg-gradient-to-r from-green-400 to-green-600' : 'bg-gradient-to-r from-red-400 to-red-600'} shadow-lg ${transaction.completed ? 'opacity-60' : ''}">
                                    <i class="fas ${transaction.type === 'income' ? 'fa-arrow-up' : 'fa-arrow-down'} text-white text-xl"></i>
                                </div>
                            </div>
                            <div>
                                <div class="flex items-center">
                                    <h4 class="font-bold text-gray-800 text-xl ${transaction.completed ? 'line-through' : ''}">${transaction.description}</h4>
                                    <span class="w-3 h-3 rounded-full ${getPriorityColor(transaction.priority)} ml-3 shadow-sm"></span>
                                    ${transaction.completed ? '<i class="fas fa-check-circle text-green-500 ml-2 text-lg"></i>' : ''}
                                </div>
                                <p class="text-sm text-gray-600 mt-1">
                                    <span class="bg-gray-100 px-3 py-1 rounded-full text-xs font-medium mr-2">${getCategoryName(transaction.category)}</span>
                                    üìÖ ${formatDate(transaction.date)} ‚Ä¢ 
                                    <span class="font-medium">${getPriorityName(transaction.priority)}</span>
                                    ${transaction.completed ? ' ‚Ä¢ ‚úÖ Conclu√≠da' : ' ‚Ä¢ ‚è≥ Pendente'}
                                </p>
                                ${transaction.observations ? `<p class="text-xs text-gray-500 mt-1 italic">üí¨ ${transaction.observations}</p>` : ''}
                            </div>
                        </div>
                        <div class="flex items-center space-x-6">
                            <span class="font-bold text-2xl ${transaction.type === 'income' ? 'text-green-600' : 'text-red-600'} ${transaction.completed ? 'line-through opacity-60' : ''}">
                                ${transaction.type === 'income' ? '+' : '-'}${formatCurrency(transaction.amount)}
                            </span>
                            <div class="flex items-center space-x-2">
                                <button onclick="toggleComplete('${transaction.id}')" class="p-3 rounded-full hover:bg-green-100 ${transaction.completed ? 'text-green-600 bg-green-50' : 'text-gray-400 hover:text-green-600'} transition-all duration-300 transform hover:scale-110">
                                    <i class="fas fa-check text-lg"></i>
                                </button>
                                <button onclick="editTransaction('${transaction.id}')" class="p-3 rounded-full hover:bg-blue-100 text-blue-600 transition-all duration-300 transform hover:scale-110">
                                    <i class="fas fa-edit text-lg"></i>
                                </button>
                                <button onclick="deleteTransaction('${transaction.id}')" class="p-3 rounded-full hover:bg-red-100 text-red-600 transition-all duration-300 transform hover:scale-110">
                                    <i class="fas fa-trash text-lg"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Filter transactions
        function getFilteredTransactions() {
            let filtered = [...transactions];
            
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filterType = document.getElementById('filterType').value;
            const filterCategory = document.getElementById('filterCategory').value;
            const filterMonth = document.getElementById('filterMonth').value;

            if (searchTerm) {
                filtered = filtered.filter(t => 
                    t.description.toLowerCase().includes(searchTerm) ||
                    getCategoryName(t.category).toLowerCase().includes(searchTerm)
                );
            }

            if (filterType !== 'all') {
                if (filterType === 'pending') {
                    filtered = filtered.filter(t => !t.completed);
                } else if (filterType === 'completed') {
                    filtered = filtered.filter(t => t.completed);
                } else {
                    filtered = filtered.filter(t => t.type === filterType);
                }
            }

            if (filterCategory !== 'all') {
                filtered = filtered.filter(t => t.category === filterCategory);
            }

            if (filterMonth) {
                filtered = filtered.filter(t => t.date.startsWith(filterMonth));
            }

            return applySorting(filtered);
        }

        // Sorting functions
        function applySorting(transactions) {
            return transactions.sort((a, b) => {
                let comparison = 0;
                
                if (currentSortBy === 'date') {
                    comparison = new Date(a.date) - new Date(b.date);
                } else if (currentSortBy === 'amount') {
                    comparison = a.amount - b.amount;
                }
                
                return sortOrder === 'desc' ? -comparison : comparison;
            });
        }

        function sortTransactions(sortBy) {
            currentSortBy = sortBy;
            updateSortButtons();
            renderTransactions();
            showSuccessMessage(`Transa√ß√µes ordenadas por ${sortBy === 'date' ? 'data' : 'valor'}!`);
        }

        function toggleSortOrder() {
            sortOrder = sortOrder === 'desc' ? 'asc' : 'desc';
            updateSortOrderButton();
            renderTransactions();
            showSuccessMessage(`Ordem alterada para ${sortOrder === 'desc' ? 'decrescente' : 'crescente'}!`);
        }

        function updateSortButtons() {
            // Reset all buttons
            document.getElementById('sortDateBtn').classList.remove('bg-white/40', 'border-white/60');
            document.getElementById('sortAmountBtn').classList.remove('bg-white/40', 'border-white/60');
            
            // Highlight active button
            if (currentSortBy === 'date') {
                document.getElementById('sortDateBtn').classList.add('bg-white/40', 'border-white/60');
            } else if (currentSortBy === 'amount') {
                document.getElementById('sortAmountBtn').classList.add('bg-white/40', 'border-white/60');
            }
        }

        function updateSortOrderButton() {
            const sortOrderBtn = document.getElementById('sortOrderBtn');
            const icon = sortOrderBtn.querySelector('i');
            
            if (sortOrder === 'desc') {
                icon.className = 'fas fa-sort-amount-down';
                sortOrderBtn.title = 'Ordem: Maior para Menor (clique para inverter)';
            } else {
                icon.className = 'fas fa-sort-amount-up';
                sortOrderBtn.title = 'Ordem: Menor para Maior (clique para inverter)';
            }
        }

        // Apply filters
        function applyFilters() {
            renderTransactions();
        }

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', applyFilters);
        document.getElementById('filterMonth').addEventListener('change', applyFilters);

        // Transaction actions
        async function toggleComplete(id) {
            const transaction = transactions.find(t => t.id === id);
            if (transaction) {
                transaction.completed = !transaction.completed;
                transaction.updatedAt = new Date().toISOString();
                
                // Auto-switch to completed filter when completing a transaction
                if (transaction.completed) {
                    document.getElementById('filterType').value = 'completed';
                }
                
                await saveTransactionToFirebase(transaction);
                showSuccessMessage(transaction.completed ? 'Transa√ß√£o conclu√≠da!' : 'Transa√ß√£o reaberta!');
            }
        }

        function editTransaction(id) {
            const transaction = transactions.find(t => t.id === id);
            if (transaction) {
                document.getElementById('editId').value = transaction.id;
                document.getElementById('editDescription').value = transaction.description;
                document.getElementById('editAmount').value = transaction.amount;
                document.getElementById('editCategory').value = transaction.category;
                document.getElementById('editDate').value = transaction.date;
                document.getElementById('editPriority').value = transaction.priority || 'baixa';
                document.getElementById('editObservations').value = transaction.observations || '';
                
                // Show installment info if it's an installment
                const editInstallmentsField = document.getElementById('editInstallmentsField');
                const editInstallments = document.getElementById('editInstallments');
                
                if (transaction.isInstallment) {
                    editInstallmentsField.style.display = 'block';
                    editInstallments.value = `${transaction.installmentNumber}/${transaction.totalInstallments}`;
                } else {
                    editInstallmentsField.style.display = 'none';
                    editInstallments.value = '';
                }
                
                document.getElementById('editModal').classList.remove('hidden');
                document.getElementById('editModal').classList.add('flex');
            }
        }

        async function deleteTransaction(id) {
            if (confirm('üóëÔ∏è Tem certeza que deseja excluir esta transa√ß√£o? Esta a√ß√£o n√£o pode ser desfeita.')) {
                await deleteTransactionFromFirebase(id);
                showSuccessMessage('Transa√ß√£o exclu√≠da com sucesso!');
            }
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.add('hidden');
            document.getElementById('editModal').classList.remove('flex');
        }

        // Calendar functionality - Fully optimized for mobile
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            document.getElementById('currentMonth').textContent = 
                new Date(year, month).toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });

            const firstDay = new Date(year, month, 1);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());

            const calendarGrid = document.getElementById('calendarGrid');
            const isMobile = window.innerWidth <= 768;
            
            // Use innerHTML for better performance
            let calendarHTML = '';

            // Days of week header - responsive
            const daysOfWeek = isMobile ? ['D', 'S', 'T', 'Q', 'Q', 'S', 'S'] : ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];
            daysOfWeek.forEach(day => {
                calendarHTML += `<div class="p-2 sm:p-4 text-center font-bold text-gray-700 bg-gradient-to-r from-indigo-100 to-purple-100 rounded-lg text-xs sm:text-base mobile-text">${day}</div>`;
            });

            // Pre-calculate transactions by date for performance
            const transactionsByDate = {};
            transactions.forEach(t => {
                if (!transactionsByDate[t.date]) {
                    transactionsByDate[t.date] = [];
                }
                transactionsByDate[t.date].push(t);
            });

            // Calendar days - mobile optimized
            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                const dateStr = date.toISOString().split('T')[0];
                const dayTransactions = transactionsByDate[dateStr] || [];
                
                const isCurrentMonth = date.getMonth() === month;
                const isToday = dateStr === new Date().toISOString().split('T')[0];
                
                let dayClass = isCurrentMonth ? 'bg-white/80 hover:bg-white' : 'bg-gray-200/50 text-gray-400';
                if (isToday && isCurrentMonth) {
                    dayClass += ' ring-2 ring-indigo-500 bg-indigo-50';
                }
                
                let dayContent = `<div class="font-bold text-center mb-1 text-xs sm:text-base mobile-text ${isToday ? 'text-indigo-600' : ''}">${date.getDate()}</div>`;
                
                // Mobile-optimized transaction indicators
                if (dayTransactions.length > 0) {
                    const incomeCount = dayTransactions.filter(t => t.type === 'income').length;
                    const expenseCount = dayTransactions.filter(t => t.type === 'expense').length;
                    
                    if (isMobile) {
                        // Mobile: Compact indicators
                        dayContent += `<div class="flex justify-center space-x-0.5 mb-1">`;
                        if (incomeCount > 0) {
                            dayContent += `<div class="w-1 h-1 rounded-full bg-green-500"></div>`;
                        }
                        if (expenseCount > 0) {
                            dayContent += `<div class="w-1 h-1 rounded-full bg-red-500"></div>`;
                        }
                        dayContent += `</div>`;
                        dayContent += `<div class="text-xs text-center text-gray-600 font-medium">${dayTransactions.length}</div>`;
                    } else {
                        // Desktop: Full indicators
                        dayContent += `<div class="flex justify-center space-x-1 mb-1">`;
                        if (incomeCount > 0) {
                            dayContent += `<div class="w-2 h-2 rounded-full bg-green-500"></div>`;
                        }
                        if (expenseCount > 0) {
                            dayContent += `<div class="w-2 h-2 rounded-full bg-red-500"></div>`;
                        }
                        dayContent += `</div>`;
                        dayContent += `<div class="text-xs text-center text-gray-600 font-medium">${dayTransactions.length}</div>`;
                    }
                }
                
                const minHeight = isMobile ? 'min-h-[45px]' : 'min-h-[80px]';
                const padding = isMobile ? 'p-1' : 'p-3';
                
                calendarHTML += `
                    <div class="calendar-day border border-white/50 ${padding} rounded-lg cursor-pointer ${dayClass} transition-colors duration-200 ${minHeight} calendar-day-mobile touch-target" 
                         onclick="showDayTransactions(new Date('${dateStr}T00:00:00'))">
                        ${dayContent}
                    </div>
                `;
            }
            
            calendarGrid.innerHTML = calendarHTML;
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        }

        // Show day transactions modal
        function showDayTransactions(date) {
            const dateStr = date.toISOString().split('T')[0];
            const dayTransactions = transactions.filter(t => t.date === dateStr);
            
            if (dayTransactions.length === 0) {
                // Show empty state
                document.getElementById('dayModalTitle').textContent = 
                    `üìÖ ${date.toLocaleDateString('pt-BR')}`;
                
                document.getElementById('dayTransactions').innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-calendar-times text-6xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500 text-lg">Nenhuma transa√ß√£o neste dia</p>
                    </div>
                `;
                
                document.getElementById('dayModal').classList.remove('hidden');
                document.getElementById('dayModal').classList.add('flex');
                return;
            }
            
            document.getElementById('dayModalTitle').textContent = 
                `üìÖ Transa√ß√µes de ${date.toLocaleDateString('pt-BR')} (${dayTransactions.length})`;
            
            const container = document.getElementById('dayTransactions');
            container.innerHTML = dayTransactions.map(transaction => `
                <div class="flex items-center justify-between p-6 bg-gradient-to-r ${
                    transaction.type === 'income' ? 'from-green-50 to-green-100 border-green-200' : 'from-red-50 to-red-100 border-red-200'
                } rounded-2xl border-2 shadow-sm hover:shadow-md transition-all duration-300 ${transaction.completed ? 'opacity-70' : ''}">
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 rounded-full flex items-center justify-center ${
                            transaction.type === 'income' ? 'bg-green-500' : 'bg-red-500'
                        } shadow-lg">
                            <i class="fas ${
                                transaction.type === 'income' ? 'fa-arrow-up' : 'fa-arrow-down'
                            } text-white text-lg"></i>
                        </div>
                        <div>
                            <h4 class="font-bold text-gray-800 text-lg ${transaction.completed ? 'line-through' : ''}">${transaction.description}</h4>
                            <p class="text-sm text-gray-600 mt-1">
                                <span class="bg-white px-2 py-1 rounded-full text-xs font-medium mr-2">${getCategoryName(transaction.category)}</span>
                                ${getPriorityName(transaction.priority)}
                                ${transaction.completed ? ' ‚Ä¢ ‚úÖ Conclu√≠da' : ' ‚Ä¢ ‚è≥ Pendente'}
                            </p>
                            ${transaction.observations ? `<p class="text-xs text-gray-500 mt-1 italic">üí¨ ${transaction.observations}</p>` : ''}
                        </div>
                    </div>
                    <div class="text-right">
                        <span class="font-bold text-xl ${
                            transaction.type === 'income' ? 'text-green-600' : 'text-red-600'
                        } ${transaction.completed ? 'line-through' : ''}">
                            ${transaction.type === 'income' ? '+' : '-'}${formatCurrency(transaction.amount)}
                        </span>
                        <div class="flex items-center justify-end mt-2 space-x-2">
                            <span class="w-3 h-3 rounded-full ${getPriorityColor(transaction.priority)} shadow-sm"></span>
                            <div class="flex space-x-1">
                                <button onclick="toggleComplete('${transaction.id}'); showDayTransactions(new Date('${transaction.date}T00:00:00'))" class="p-2 rounded-full hover:bg-green-100 ${transaction.completed ? 'text-green-600 bg-green-50' : 'text-gray-400 hover:text-green-600'} transition-all duration-200">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button onclick="editTransaction('${transaction.id}')" class="p-2 rounded-full hover:bg-blue-100 text-blue-600 transition-all duration-200">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deleteTransaction('${transaction.id}'); closeDayModal()" class="p-2 rounded-full hover:bg-red-100 text-red-600 transition-all duration-200">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('dayModal').classList.remove('hidden');
            document.getElementById('dayModal').classList.add('flex');
        }

        function closeDayModal() {
            document.getElementById('dayModal').classList.add('hidden');
            document.getElementById('dayModal').classList.remove('flex');
        }

        // Charts
        function initCharts() {
            const ctx1 = document.getElementById('categoryChart').getContext('2d');
            const ctx2 = document.getElementById('monthlyChart').getContext('2d');

            categoryChart = new Chart(ctx1, {
                type: 'doughnut',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: [
                            '#ef4444', '#f97316', '#eab308', '#22c55e',
                            '#06b6d4', '#3b82f6', '#8b5cf6', '#ec4899'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            monthlyChart = new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Receitas',
                        data: [],
                        borderColor: '#22c55e',
                        backgroundColor: 'rgba(34, 197, 94, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'Despesas',
                        data: [],
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            updateCharts();
        }

        function updateCharts() {
            updateDashboardCharts();
        }

        function updateDashboardCharts() {
            const filteredTransactions = getDashboardFilteredTransactions();
            
            // Category chart
            const expensesByCategory = {};
            filteredTransactions.filter(t => t.type === 'expense').forEach(t => {
                expensesByCategory[t.category] = (expensesByCategory[t.category] || 0) + t.amount;
            });

            categoryChart.data.labels = Object.keys(expensesByCategory).map(getCategoryName);
            categoryChart.data.datasets[0].data = Object.values(expensesByCategory);
            categoryChart.update();

            // Monthly chart - show evolution over time
            const monthlyData = {};
            
            // If a specific month is selected, show daily breakdown
            const filterMonth = document.getElementById('dashboardFilterMonth').value;
            if (filterMonth) {
                // Daily breakdown for selected month
                const daysInMonth = new Date(filterMonth.split('-')[0], filterMonth.split('-')[1], 0).getDate();
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayStr = `${filterMonth}-${day.toString().padStart(2, '0')}`;
                    monthlyData[dayStr] = { income: 0, expense: 0 };
                }
                
                filteredTransactions.forEach(t => {
                    const date = t.date;
                    if (monthlyData[date]) {
                        monthlyData[date][t.type] += t.amount;
                    }
                });
                
                const sortedDays = Object.keys(monthlyData).sort();
                monthlyChart.data.labels = sortedDays.map(date => {
                    const day = date.split('-')[2];
                    return `Dia ${parseInt(day)}`;
                });
                monthlyChart.data.datasets[0].data = sortedDays.map(date => monthlyData[date].income);
                monthlyChart.data.datasets[1].data = sortedDays.map(date => monthlyData[date].expense);
            } else {
                // Monthly breakdown for all data
                transactions.forEach(t => {
                    const month = t.date.substring(0, 7);
                    if (!monthlyData[month]) {
                        monthlyData[month] = { income: 0, expense: 0 };
                    }
                    monthlyData[month][t.type] += t.amount;
                });

                const sortedMonths = Object.keys(monthlyData).sort();
                monthlyChart.data.labels = sortedMonths.map(month => {
                    const [year, monthNum] = month.split('-');
                    return new Date(year, monthNum - 1).toLocaleDateString('pt-BR', { month: 'short', year: 'numeric' });
                });
                monthlyChart.data.datasets[0].data = sortedMonths.map(month => monthlyData[month].income);
                monthlyChart.data.datasets[1].data = sortedMonths.map(month => monthlyData[month].expense);
            }
            
            monthlyChart.update();
        }

        // Details modal functions
        function showIncomeDetails() {
            const currentYear = new Date().getFullYear();
            const currentMonth = new Date().toISOString().substring(0, 7);
            const nextMonth = new Date();
            nextMonth.setMonth(nextMonth.getMonth() + 1);
            const nextMonthStr = nextMonth.toISOString().substring(0, 7);
            
            // Filter income transactions
            const currentMonthIncome = transactions.filter(t => t.type === 'income' && t.date.startsWith(currentMonth));
            const nextMonthIncome = transactions.filter(t => t.type === 'income' && t.date.startsWith(nextMonthStr));
            const yearIncome = transactions.filter(t => t.type === 'income' && t.date.startsWith(currentYear.toString()));
            
            const currentMonthTotal = currentMonthIncome.reduce((sum, t) => sum + t.amount, 0);
            const nextMonthTotal = nextMonthIncome.reduce((sum, t) => sum + t.amount, 0);
            const yearTotal = yearIncome.reduce((sum, t) => sum + t.amount, 0);
            
            document.getElementById('detailsModalTitle').innerHTML = 'üí∞ Detalhes das Receitas';
            
            const content = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="bg-gradient-to-br from-green-100 to-green-200 p-6 rounded-2xl border-2 border-green-300">
                        <h4 class="font-bold text-green-800 text-lg mb-2">üìÖ M√™s Atual</h4>
                        <p class="text-2xl font-bold text-green-600">${formatCurrency(currentMonthTotal)}</p>
                        <p class="text-sm text-green-700 mt-1">${currentMonthIncome.length} transa√ß√µes</p>
                    </div>
                    <div class="bg-gradient-to-br from-blue-100 to-blue-200 p-6 rounded-2xl border-2 border-blue-300">
                        <h4 class="font-bold text-blue-800 text-lg mb-2">üìÖ Pr√≥ximo M√™s</h4>
                        <p class="text-2xl font-bold text-blue-600">${formatCurrency(nextMonthTotal)}</p>
                        <p class="text-sm text-blue-700 mt-1">${nextMonthIncome.length} transa√ß√µes</p>
                    </div>
                    <div class="bg-gradient-to-br from-purple-100 to-purple-200 p-6 rounded-2xl border-2 border-purple-300">
                        <h4 class="font-bold text-purple-800 text-lg mb-2">üìÖ Total ${currentYear}</h4>
                        <p class="text-2xl font-bold text-purple-600">${formatCurrency(yearTotal)}</p>
                        <p class="text-sm text-purple-700 mt-1">${yearIncome.length} transa√ß√µes</p>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <h5 class="text-lg font-bold text-gray-800 border-b pb-2">üìã √öltimas Receitas</h5>
                    ${yearIncome.slice(0, 10).map(t => `
                        <div class="flex items-center justify-between p-4 bg-green-50 rounded-xl border border-green-200">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center">
                                    <i class="fas fa-arrow-up text-white"></i>
                                </div>
                                <div>
                                    <h6 class="font-semibold text-gray-800">${t.description}</h6>
                                    <p class="text-sm text-gray-600">${formatDate(t.date)} ‚Ä¢ ${getCategoryName(t.category)}</p>
                                </div>
                            </div>
                            <span class="font-bold text-green-600">+${formatCurrency(t.amount)}</span>
                        </div>
                    `).join('')}
                </div>
            `;
            
            document.getElementById('detailsContent').innerHTML = content;
            document.getElementById('detailsModal').classList.remove('hidden');
            document.getElementById('detailsModal').classList.add('flex');
        }
        
        function showExpenseDetails() {
            const currentYear = new Date().getFullYear();
            const currentMonth = new Date().toISOString().substring(0, 7);
            const nextMonth = new Date();
            nextMonth.setMonth(nextMonth.getMonth() + 1);
            const nextMonthStr = nextMonth.toISOString().substring(0, 7);
            
            // Filter expense transactions
            const currentMonthExpenses = transactions.filter(t => t.type === 'expense' && t.date.startsWith(currentMonth));
            const nextMonthExpenses = transactions.filter(t => t.type === 'expense' && t.date.startsWith(nextMonthStr));
            const yearExpenses = transactions.filter(t => t.type === 'expense' && t.date.startsWith(currentYear.toString()));
            
            const currentMonthTotal = currentMonthExpenses.reduce((sum, t) => sum + t.amount, 0);
            const nextMonthTotal = nextMonthExpenses.reduce((sum, t) => sum + t.amount, 0);
            const yearTotal = yearExpenses.reduce((sum, t) => sum + t.amount, 0);
            
            document.getElementById('detailsModalTitle').innerHTML = 'üí∏ Detalhes das Despesas';
            
            const content = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="bg-gradient-to-br from-red-100 to-red-200 p-6 rounded-2xl border-2 border-red-300">
                        <h4 class="font-bold text-red-800 text-lg mb-2">üìÖ M√™s Atual</h4>
                        <p class="text-2xl font-bold text-red-600">${formatCurrency(currentMonthTotal)}</p>
                        <p class="text-sm text-red-700 mt-1">${currentMonthExpenses.length} transa√ß√µes</p>
                    </div>
                    <div class="bg-gradient-to-br from-orange-100 to-orange-200 p-6 rounded-2xl border-2 border-orange-300">
                        <h4 class="font-bold text-orange-800 text-lg mb-2">üìÖ Pr√≥ximo M√™s</h4>
                        <p class="text-2xl font-bold text-orange-600">${formatCurrency(nextMonthTotal)}</p>
                        <p class="text-sm text-orange-700 mt-1">${nextMonthExpenses.length} transa√ß√µes</p>
                    </div>
                    <div class="bg-gradient-to-br from-purple-100 to-purple-200 p-6 rounded-2xl border-2 border-purple-300">
                        <h4 class="font-bold text-purple-800 text-lg mb-2">üìÖ Total ${currentYear}</h4>
                        <p class="text-2xl font-bold text-purple-600">${formatCurrency(yearTotal)}</p>
                        <p class="text-sm text-purple-700 mt-1">${yearExpenses.length} transa√ß√µes</p>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <h5 class="text-lg font-bold text-gray-800 border-b pb-2">üìã √öltimas Despesas</h5>
                    ${yearExpenses.slice(0, 10).map(t => `
                        <div class="flex items-center justify-between p-4 bg-red-50 rounded-xl border border-red-200">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-red-500 rounded-full flex items-center justify-center">
                                    <i class="fas fa-arrow-down text-white"></i>
                                </div>
                                <div>
                                    <h6 class="font-semibold text-gray-800">${t.description}</h6>
                                    <p class="text-sm text-gray-600">${formatDate(t.date)} ‚Ä¢ ${getCategoryName(t.category)}</p>
                                </div>
                            </div>
                            <span class="font-bold text-red-600">-${formatCurrency(t.amount)}</span>
                        </div>
                    `).join('')}
                </div>
            `;
            
            document.getElementById('detailsContent').innerHTML = content;
            document.getElementById('detailsModal').classList.remove('hidden');
            document.getElementById('detailsModal').classList.add('flex');
        }
        
        function showPendingDetails() {
            const currentYear = new Date().getFullYear();
            const currentMonth = new Date().toISOString().substring(0, 7);
            const nextMonth = new Date();
            nextMonth.setMonth(nextMonth.getMonth() + 1);
            const nextMonthStr = nextMonth.toISOString().substring(0, 7);
            
            // Filter pending transactions (only expenses)
            const currentMonthPending = transactions.filter(t => !t.completed && t.type === 'expense' && t.date.startsWith(currentMonth));
            const nextMonthPending = transactions.filter(t => !t.completed && t.type === 'expense' && t.date.startsWith(nextMonthStr));
            const yearPending = transactions.filter(t => !t.completed && t.type === 'expense' && t.date.startsWith(currentYear.toString()));
            
            const currentMonthTotal = currentMonthPending.reduce((sum, t) => sum + t.amount, 0);
            const nextMonthTotal = nextMonthPending.reduce((sum, t) => sum + t.amount, 0);
            const yearTotal = yearPending.reduce((sum, t) => sum + t.amount, 0);
            
            document.getElementById('detailsModalTitle').innerHTML = '‚è≥ Detalhes das Contas Pendentes';
            
            const content = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="bg-gradient-to-br from-yellow-100 to-yellow-200 p-6 rounded-2xl border-2 border-yellow-300">
                        <h4 class="font-bold text-yellow-800 text-lg mb-2">üìÖ M√™s Atual</h4>
                        <p class="text-2xl font-bold text-yellow-600">${currentMonthPending.length}</p>
                        <p class="text-sm text-yellow-700 mt-1">${formatCurrency(currentMonthTotal)} pendente</p>
                    </div>
                    <div class="bg-gradient-to-br from-blue-100 to-blue-200 p-6 rounded-2xl border-2 border-blue-300">
                        <h4 class="font-bold text-blue-800 text-lg mb-2">üìÖ Pr√≥ximo M√™s</h4>
                        <p class="text-2xl font-bold text-blue-600">${nextMonthPending.length}</p>
                        <p class="text-sm text-blue-700 mt-1">${formatCurrency(nextMonthTotal)} pendente</p>
                    </div>
                    <div class="bg-gradient-to-br from-purple-100 to-purple-200 p-6 rounded-2xl border-2 border-purple-300">
                        <h4 class="font-bold text-purple-800 text-lg mb-2">üìÖ Total ${currentYear}</h4>
                        <p class="text-2xl font-bold text-purple-600">${yearPending.length}</p>
                        <p class="text-sm text-purple-700 mt-1">${formatCurrency(yearTotal)} pendente</p>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <h5 class="text-lg font-bold text-gray-800 border-b pb-2">üìã Contas Pendentes</h5>
                    ${yearPending.slice(0, 10).map(t => `
                        <div class="flex items-center justify-between p-4 bg-yellow-50 rounded-xl border border-yellow-200">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-yellow-500 rounded-full flex items-center justify-center">
                                    <i class="fas fa-clock text-white"></i>
                                </div>
                                <div>
                                    <h6 class="font-semibold text-gray-800">${t.description}</h6>
                                    <p class="text-sm text-gray-600">${formatDate(t.date)} ‚Ä¢ ${getCategoryName(t.category)} ‚Ä¢ ${getPriorityName(t.priority)}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="font-bold text-gray-800">${formatCurrency(t.amount)}</span>
                                <button onclick="toggleComplete('${t.id}'); closeDetailsModal()" class="ml-3 p-2 bg-green-500 hover:bg-green-600 text-white rounded-full transition-all duration-300">
                                    <i class="fas fa-check text-sm"></i>
                                </button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            document.getElementById('detailsContent').innerHTML = content;
            document.getElementById('detailsModal').classList.remove('hidden');
            document.getElementById('detailsModal').classList.add('flex');
        }
        
        function closeDetailsModal() {
            document.getElementById('detailsModal').classList.add('hidden');
            document.getElementById('detailsModal').classList.remove('flex');
        }

        // Utility functions
        function formatCurrency(amount) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(amount);
        }

        function formatDate(dateStr) {
            return new Date(dateStr + 'T00:00:00').toLocaleDateString('pt-BR');
        }

        function getCategoryName(category) {
            const categories = {
                'alimentacao': 'Alimenta√ß√£o',
                'transporte': 'Transporte',
                'moradia': 'Moradia',
                'saude': 'Sa√∫de',
                'educacao': 'Educa√ß√£o',
                'lazer': 'Lazer',
                'salario': 'Sal√°rio',
                'freelance': 'Freelance',
                'investimentos': 'Investimentos',
                'outros': 'Outros'
            };
            return categories[category] || category;
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96e98c11b50b521f',t:'MTc1NTEwMjEwMy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
